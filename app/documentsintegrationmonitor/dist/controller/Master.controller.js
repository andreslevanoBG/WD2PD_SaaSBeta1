sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/FilterOperator","sap/m/GroupHeaderListItem","sap/ui/Device","sap/ui/core/Fragment","../model/formatter"],function(e,t,i,s,a,r,o,n,l,g){"use strict";return e.extend("shapein.DocumentsIntegrationMonitor.controller.Master",{formatter:g,oFormatYyyymmdd:null,fromDatePreviousValue:"",toDatePreviousValue:"",numItems1PreviousValue:0,numItems2PreviousValue:0,onInit:function(){this.oFormatYyyymmdd=sap.ui.core.format.DateFormat.getInstance({pattern:"dd.MM.yyyy",calendarType:sap.ui.core.CalendarType.Gregorian});var e=this.byId("list"),t=this._createViewModel(),i=e.getBusyIndicatorDelay();var s=this.byId("list_emp");var a=this.byId("list_tem");this._oList=e;this._oList_emp=s;this._oList_tem=a;this._oListFilterState={aFilter:[],aSearch:[]};this._oListFilterStateEmp={aFilter:[],aSearch:[]};this._oListFilterStateTem={aFilter:[],aSearch:[]};this.setModel(t,"masterView");e.attachEventOnce("updateFinished",function(){t.setProperty("/delay",i)});this.getView().addEventDelegate({onBeforeFirstShow:function(){this.getOwnerComponent().oListSelector.setBoundMasterList(e)}.bind(this)});this.getRouter().getRoute("master").attachPatternMatched(this._onMasterMatched,this);this.getRouter().attachBypassed(this.onBypassed,this);t.setProperty("/isFilterBarVisible",true);t.setProperty("/filterBarLabel","Past 24 Hours")},onUpdateFinished:function(e){this._updateListItemCount(e.getParameter("total"))},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh();return}var t=e.getParameter("query");if(t){this._oListFilterState.aSearch=new s({filters:[new s("tolower(template/template_id)",r.Contains,"'"+t.toLowerCase()+"'"),new s("tolower(template/doc_title)",r.Contains,"'"+t.toLowerCase()+"'")],and:false})}else{this._oListFilterState.aSearch=[]}this._oList.getBinding("items").filter(this._oListFilterState.aSearch,"Application")},onSearchEmpl:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh();return}var t=e.getParameter("query");if(t){this._oListFilterStateEmp.aSearch=new s({filters:[new s("tolower(employee_number)",r.Contains,"'"+t.toLowerCase()+"'"),new s("tolower(worker/firstname)",r.Contains,"'"+t.toLowerCase()+"'"),new s("tolower(worker/lastname)",r.Contains,"'"+t.toLowerCase()+"'")],and:false})}else{this._oListFilterStateEmp.aSearch=[]}this._oList_emp.getBinding("items").filter(this._oListFilterStateEmp.aSearch,"Application")},onSearchTemp:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh();return}var t=e.getParameter("query");if(t){this._oListFilterStateTem.aSearch=new s({filters:[new s("tolower(template_id)",r.Contains,"'"+t.toLowerCase()+"'"),new s("tolower(doc_title)",r.Contains,"'"+t.toLowerCase()+"'")],and:false})}else{this._oListFilterStateTem.aSearch=[]}this._oList_tem.getBinding("items").filter(this._oListFilterStateTem.aSearch,"Application")},onRefresh:function(){this._oList.getBinding("items").refresh()},onOpenViewSettings:function(e){var t="filter";if(e.getSource()instanceof sap.m.Button){var i=e.getSource().getId();if(i.match("sort")){t="sort"}else if(i.match("group")){t="group"}}if(!this.byId("viewSettingsDialog")){l.load({id:this.getView().getId(),name:"shapein.DocumentsIntegrationMonitor.view.ViewSettingsDialog",controller:this}).then(function(e){this.getView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());e.open(t)}.bind(this))}else{this.byId("viewSettingsDialog").open(t)}},onOpenViewSettingsEmpl:function(e){var t="filter";if(e.getSource()instanceof sap.m.Button){var i=e.getSource().getId();if(i.match("sort")){t="sort"}else if(i.match("group")){t="group"}}if(!this.byId("viewSettingsDialogEmpl")){l.load({id:this.getView().getId(),name:"shapein.DocumentsIntegrationMonitor.view.ViewSettingsDialogEmpl",controller:this}).then(function(e){this.getView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());e.open(t)}.bind(this))}else{this.byId("viewSettingsDialogEmpl").open(t)}},onOpenViewSettingsTemp:function(e){var t="filter";if(e.getSource()instanceof sap.m.Button){var i=e.getSource().getId();if(i.match("sort")){t="sort"}else if(i.match("group")){t="group"}}if(!this.byId("viewSettingsDialogTemp")){l.load({id:this.getView().getId(),name:"shapein.DocumentsIntegrationMonitor.view.ViewSettingsDialogTemp",controller:this}).then(function(e){this.getView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());e.open(t)}.bind(this))}else{this.byId("viewSettingsDialogTemp").open(t)}},date2digits:function(e){if(e<10){return"0"+e}return e},onConfirmViewSettingsDialog:function(e){var t=e.getParameters().filterItems,i=[],a=[];var o=this.byId("viewSettingsDialog").getFilterItems()[0].getCustomControl();var n=o.getContent()[1].getValue();var l=o.getContent()[3].getValue();this.fromDatePreviousValue=n;this.toDatePreviousValue=l;var g=this.getModel("masterView");var u=o.getContent()[1].getDateValue();var h=o.getContent()[3].getDateValue();if(n!==""){var m=u.getUTCFullYear();var d=u.getUTCMonth()+1;d=this.date2digits(d);var p=u.getUTCDate();p=this.date2digits(p);var c=u.getUTCHours();c=this.date2digits(c);var v=u.getUTCMinutes();v=this.date2digits(v);var f=u.getUTCSeconds();f=this.date2digits(f);var S=m+"-"+d+"-"+p+"T"+c+":"+v+":"+f+"Z"}if(l!==""){var w=h.getUTCFullYear();var C=h.getUTCMonth()+1;C=this.date2digits(C);var y=h.getUTCDate();y=this.date2digits(y);var F=h.getUTCHours();F=this.date2digits(F);var I=h.getUTCMinutes();I=this.date2digits(I);var V=h.getUTCSeconds();V=this.date2digits(V);var D=w+"-"+C+"-"+y+"T"+F+":"+I+":"+V+"Z"}if(D&&!S){i.push(new s([new s("timestamp_start",r.LE,D)],true));var _=this.oFormatYyyymmdd.format(o.getContent()[3].getDateValue());_="Processes to "+_;this._updateFilterBar(_)}else if(S&&!D){i.push(new s([new s("timestamp_start",r.GE,S)],true));var _=this.oFormatYyyymmdd.format(o.getContent()[1].getDateValue());_="Processes from "+_;this._updateFilterBar(_)}else if(S&&D){i.push(new s([new s("timestamp_start",r.LE,D),new s("timestamp_start",r.GE,S)],true));var _=this.oFormatYyyymmdd.format(o.getContent()[1].getDateValue());var T=this.oFormatYyyymmdd.format(o.getContent()[3].getDateValue());_="Processes between "+_+" - "+T;this._updateFilterBar(_)}else{this._updateFilterBar("Past 24 Hours")}var P=[];t.forEach(function(e){if(e.getKey()!=="timestamp_start"&&e.getKey()!=="numberOfItems"){P.push(new s(e.getParent().getKey(),r.EQ,e.getKey()))}});if(P.length>0){i.push(new s(P,false))}this._oListFilterState.aFilter=i;this._applyFilterSearch();this._applySortGroup(e)},onConfirmViewSettingsDialogEmpl:function(e){var t=e.getParameters().filterItems,i=[],a=[];t=this.byId("viewSettingsDialogEmpl").getFilterItems();var o=this.byId("viewSettingsDialogEmpl").getFilterItems()[0].getCustomControl();var n=o.getContent()[1].getValue();var l=o.getContent()[3].getValue();this.fromWorkerPreviousValue=n;this.toWorkerPreviousValue=l;if(n!==""&&l==""){i.push(new s([new s(t[0].getKey(),r.GE,n)],true))}else if(n==""&&l!==""){i.push(new s([new s(t[0].getKey(),r.LE,l)],true))}else if(n!==""&&l!==""){i.push(new s([new s(t[0].getKey(),r.GE,n),new s(t[0].getKey(),r.LE,l)],true))}var g=this.byId("viewSettingsDialogEmpl").getFilterItems()[1].getCustomControl();var u=g.getContent()[1].getValue();var h=g.getContent()[3].getValue();this.fromLastPreviousValue=u;this.toLastPreviousValue=h;if(u!==""&&h==""){i.push(new s([new s(t[1].getKey(),r.GE,u)],true))}else if(u==""&&h!==""){i.push(new s([new s(t[1].getKey(),r.LE,h)],true))}else if(u!==""&&h!==""){i.push(new s([new s(t[1].getKey(),r.BT,u,h)],true))}this._oListFilterState.aFilter=i;this._applyFilterSearchEmpl();this._applySortGroupEmpl(e)},onConfirmViewSettingsDialogTemp:function(e){var t=e.getParameters().filterItems,i=[],a=[];t=this.byId("viewSettingsDialogTemp").getFilterItems();var o=this.byId("viewSettingsDialogTemp").getFilterItems()[0].getCustomControl();var n=o.getContent()[1].getValue();var l=o.getContent()[3].getValue();this.fromLastPreviousValue=n;this.toLastPreviousValue=l;if(n!==""&&l==""){i.push(new s([new s(t[0].getKey(),r.GE,n)],true))}else if(n==""&&l!==""){i.push(new s([new s(t[0].getKey(),r.LE,l)],true))}else if(n!==""&&l!==""){i.push(new s([new s(t[0].getKey(),r.BT,n,l)],true))}var g=this.byId("viewSettingsDialogTemp").getFilterItems()[1].getCustomControl();var n=g.getContent()[1].getValue();var l=g.getContent()[3].getValue();this.fromLastPreviousValue=n;this.toLastPreviousValue=l;if(n!==""&&l==""){i.push(new s([new s(t[1].getKey(),r.GE,n)],true))}else if(n==""&&l!==""){i.push(new s([new s(t[1].getKey(),r.LE,l)],true))}else if(n!==""&&l!==""){i.push(new s([new s(t[1].getKey(),r.BT,n,l)],true))}var u=this.byId("viewSettingsDialogTemp").getFilterItems()[2].getCustomControl();var n=u.getContent()[1].getValue();var l=u.getContent()[3].getValue();this.fromLastPreviousValue=n;this.toLastPreviousValue=l;if(n!==""&&l==""){i.push(new s([new s(t[2].getKey(),r.GE,n)],true))}else if(n==""&&l!==""){i.push(new s([new s(t[2].getKey(),r.LE,l)],true))}else if(n!==""&&l!==""){i.push(new s([new s(t[2].getKey(),r.BT,n,l)],true))}this._oListFilterState.aFilter=i;this._applyFilterSearchTemp();this._applySortGroupTemp(e)},_applySortGroup:function(e){var t=e.getParameters(),i,s,r=[];i=t.sortItem.getKey();s=t.sortDescending;r.push(new a(i,s));this._oList.getBinding("items").sort(r)},_applySortGroupEmpl:function(e){var t=e.getParameters(),i,s,r=[];i=t.sortItem.getKey();s=t.sortDescending;r.push(new a(i,s));this._oList_emp.getBinding("items").sort(r)},_applySortGroupTemp:function(e){var t=e.getParameters(),i,s,r=[];i=t.sortItem.getKey();s=t.sortDescending;r.push(new a(i,s));this._oList_tem.getBinding("items").sort(r)},onSelectionChange:function(e){var t=e.getSource(),i=e.getParameter("selected");if(!(t.getMode()==="MultiSelect"&&!i)){this._showDetail(e.getParameter("listItem")||e.getSource())}},onSelectionChangeEmpl:function(e){var t=e.getSource(),i=e.getParameter("selected");if(!(t.getMode()==="MultiSelect"&&!i)){this._showDetailEmpl(e.getParameter("listItem")||e.getSource())}},onSelectionChangeTemp:function(e){var t=e.getSource(),i=e.getParameter("selected");if(!(t.getMode()==="MultiSelect"&&!i)){this._showDetailTemp(e.getParameter("listItem")||e.getSource())}},onBypassed:function(){this._oList.removeSelections(true)},createGroupHeader:function(e){return new o({title:e.text,upperCase:false})},onNavBack:function(){history.go(-1)},_createViewModel:function(){return new t({isFilterBarVisible:false,filterBarLabel:"",delay:0,title:this.getResourceBundle().getText("masterTitleCount",[0]),noDataText:this.getResourceBundle().getText("masterListNoDataText"),sortBy:"uuid",groupBy:"None"})},_onMasterMatched:function(){this.getModel("appView").setProperty("/layout","OneColumn")},_showDetail:function(e){var t=!n.system.phone;this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getRouter().navTo("object",{objectId:e.getBindingContext().getProperty("uuid")},t)},_showDetailEmpl:function(e){var t=!n.system.phone;this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getRouter().navTo("objectempl",{objectId:e.getBindingContext().getProperty("uuid")},t)},_showDetailTemp:function(e){var t=!n.system.phone;this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getRouter().navTo("objecttemp",{objectId:e.getBindingContext().getProperty("uuid")},t)},_updateListItemCount:function(e){var t;if(this._oList.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("masterTitleCount",[e]);this.getModel("masterView").setProperty("/title",t)}},_applyFilterSearch:function(){var e=this._oListFilterState.aSearch.concat(this._oListFilterState.aFilter),t=this.getModel("masterView");this._oList.getBinding("items").filter(e,"Application");if(e.length!==0){t.setProperty("/noDataText",this.getResourceBundle().getText("masterListNoDataWithFilterOrSearchText"))}else if(this._oListFilterState.aSearch.length>0){t.setProperty("/noDataText",this.getResourceBundle().getText("masterListNoDataText"))}},_applyFilterSearchEmpl:function(){var e=this._oListFilterState.aSearch.concat(this._oListFilterState.aFilter),t=this.getModel("masterView");this._oList_emp.getBinding("items").filter(e,"Application");if(e.length!==0){t.setProperty("/noDataText",this.getResourceBundle().getText("masterListNoDataWithFilterOrSearchText"))}else if(this._oListFilterState.aSearch.length>0){t.setProperty("/noDataText",this.getResourceBundle().getText("masterListNoDataText"))}},_applyFilterSearchTemp:function(){var e=this._oListFilterState.aSearch.concat(this._oListFilterState.aFilter),t=this.getModel("masterView");this._oList_tem.getBinding("items").filter(e,"Application");if(e.length!==0){t.setProperty("/noDataText",this.getResourceBundle().getText("masterListNoDataWithFilterOrSearchText"))}else if(this._oListFilterState.aSearch.length>0){t.setProperty("/noDataText",this.getResourceBundle().getText("masterListNoDataText"))}},_updateFilterBar:function(e){var t=this.getModel("masterView");t.setProperty("/isFilterBarVisible",this._oListFilterState.aFilter.length>0);t.setProperty("/filterBarLabel",this.getResourceBundle().getText("Past 24 Hours",[e]))},filter24hours:function(){var e=[];var t=new Date;var i=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()-1,t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds()));var a=JSON.parse(JSON.stringify(i));var o=a;e.push(new s([new s("timestamp_start",r.GE,o)],true));this._oListFilterState.aFilter=e;this._applyFilterSearch()},changeDates:function(e){var t=this.byId("viewSettingsDialog").getFilterItems()[0].getCustomControl();var i=this.byId("viewSettingsDialog").getFilterItems()[0];var s=t.getContent()[1].getValue();var a=t.getContent()[3].getValue();if(s==""&&a==""){i.setFilterCount(0);i.setSelected(false)}else{i.setFilterCount(1);i.setSelected(true)}},changeSlider:function(e){var t=this.byId("viewSettingsDialog").getFilterItems()[2].getCustomControl();var i=this.byId("viewSettingsDialog").getFilterItems()[2];var s=parseInt(t.getValue());var a=parseInt(t.getValue2());if(s==0&&s==0){i.setFilterCount(0);i.setSelected(false)}else{i.setFilterCount(1);i.setSelected(true)}},handleCancel:function(){var e=this.byId("viewSettingsDialog").getFilterItems()[0].getCustomControl();var t=this.byId("viewSettingsDialog").getFilterItems()[0],i=e.getContent()[1],s=e.getContent()[3];var a=this.byId("viewSettingsDialog").getFilterItems()[2].getCustomControl();var r=this.byId("viewSettingsDialog").getFilterItems()[2];i.setValue(this.fromDatePreviousValue);s.setValue(this.toDatePreviousValue);a.setValue(this.numItems1PreviousValue);a.setValue2(this.numItems2PreviousValue);if(this.fromDatePreviousValue!==""||this.toDatePreviousValue!==""){t.setFilterCount(1);t.setSelected(true)}else{t.setFilterCount(0);t.setSelected(false)}if(this.numItems1PreviousValue!==0||this.numItems2PreviousValue!==0){r.setFilterCount(1);r.setSelected(true)}else{r.setFilterCount(0);r.setSelected(false)}},handleCancelEmpl:function(){var e=this.byId("viewSettingsDialogEmpl").getFilterItems()[0].getCustomControl();var t=this.byId("viewSettingsDialogEmpl").getFilterItems()[0],i=e.getContent()[1],s=e.getContent()[3];var a=this.byId("viewSettingsDialogEmpl").getFilterItems()[2].getCustomControl();var r=this.byId("viewSettingsDialogEmpl").getFilterItems()[2];i.setValue(this.fromDatePreviousValue);s.setValue(this.toDatePreviousValue);a.setValue(this.numItems1PreviousValue);a.setValue2(this.numItems2PreviousValue);if(this.fromDatePreviousValue!==""||this.toDatePreviousValue!==""){t.setFilterCount(1);t.setSelected(true)}else{t.setFilterCount(0);t.setSelected(false)}if(this.numItems1PreviousValue!==0||this.numItems2PreviousValue!==0){r.setFilterCount(1);r.setSelected(true)}else{r.setFilterCount(0);r.setSelected(false)}},handleCancelTemp:function(){var e=this.byId("viewSettingsDialogTemp").getFilterItems()[0].getCustomControl();var t=this.byId("viewSettingsDialogTemp").getFilterItems()[0],i=e.getContent()[1],s=e.getContent()[3];var a=this.byId("viewSettingsDialogTemp").getFilterItems()[2].getCustomControl();var r=this.byId("viewSettingsDialogTemp").getFilterItems()[2];i.setValue(this.fromDatePreviousValue);s.setValue(this.toDatePreviousValue);a.setValue(this.numItems1PreviousValue);a.setValue2(this.numItems2PreviousValue);if(this.fromDatePreviousValue!==""||this.toDatePreviousValue!==""){t.setFilterCount(1);t.setSelected(true)}else{t.setFilterCount(0);t.setSelected(false)}if(this.numItems1PreviousValue!==0||this.numItems2PreviousValue!==0){r.setFilterCount(1);r.setSelected(true)}else{r.setFilterCount(0);r.setSelected(false)}},handleResetFilters:function(){var e=this.byId("viewSettingsDialog").getFilterItems()[0].getCustomControl();var t=this.byId("viewSettingsDialog").getFilterItems()[0],i=e.getContent()[1],s=e.getContent()[3];i.setValue("");s.setValue("");t.setFilterCount(0);t.setSelected(false);var a=this.byId("viewSettingsDialog").getFilterItems()[2].getCustomControl();var r=this.byId("viewSettingsDialog").getFilterItems()[2];a.setValue(0);a.setValue2(0);r.setFilterCount(0);r.setSelected(false)},handleResetFiltersEmpl:function(){var e=this.byId("viewSettingsDialogEmpl").getFilterItems()[0].getCustomControl();var t=this.byId("viewSettingsDialogEmpl").getFilterItems()[0],i=e.getContent()[1],s=e.getContent()[3];i.setValue("");s.setValue("");t.setFilterCount(0);t.setSelected(false);var a=this.byId("viewSettingsDialogEmpl").getFilterItems()[2].getCustomControl();var r=this.byId("viewSettingsDialogEmpl").getFilterItems()[2];a.setValue(0);a.setValue2(0);r.setFilterCount(0);r.setSelected(false)},handleResetFiltersTemp:function(){var e=this.byId("viewSettingsDialogTemp").getFilterItems()[0].getCustomControl();var t=this.byId("viewSettingsDialogTemp").getFilterItems()[0],i=e.getContent()[1],s=e.getContent()[3];i.setValue("");s.setValue("");t.setFilterCount(0);t.setSelected(false);var a=this.byId("viewSettingsDialogTemp").getFilterItems()[2].getCustomControl();var r=this.byId("viewSettingsDialogTemp").getFilterItems()[2];a.setValue(0);a.setValue2(0);r.setFilterCount(0);r.setSelected(false)}})});