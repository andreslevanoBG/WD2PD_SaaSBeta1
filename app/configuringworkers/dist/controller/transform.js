/*	This work is licensed under Creative Commons GNU LGPL License.

	License: http://creativecommons.org/licenses/LGPL/2.1/
   Version: 0.9
	Author:  Stefan Goessner/2006
	Web:     http://goessner.net/ 
*/
function xml2json(e,n){var t={toObj:function(e){var n={};if(e.nodeType==1){if(e.attributes.length)for(var i=0;i<e.attributes.length;i++)n["@"+e.attributes[i].nodeName]=(e.attributes[i].nodeValue||"").toString();if(e.firstChild){var r=0,l=0,o=false;for(var a=e.firstChild;a;a=a.nextSibling){if(a.nodeType==1)o=true;else if(a.nodeType==3&&a.nodeValue.match(/[^ \f\n\r\t\v]/))r++;else if(a.nodeType==4)l++}if(o){if(r<2&&l<2){t.removeWhite(e);for(var a=e.firstChild;a;a=a.nextSibling){if(a.nodeType==3)n["#text"]=t.escape(a.nodeValue);else if(a.nodeType==4)n["#cdata"]=t.escape(a.nodeValue);else if(n[a.nodeName]){if(n[a.nodeName]instanceof Array)n[a.nodeName][n[a.nodeName].length]=t.toObj(a);else n[a.nodeName]=[n[a.nodeName],t.toObj(a)]}else n[a.nodeName]=t.toObj(a)}}else{if(!e.attributes.length)n=t.escape(t.innerXml(e));else n["#text"]=t.escape(t.innerXml(e))}}else if(r){if(!e.attributes.length)n=t.escape(t.innerXml(e));else n["#text"]=t.escape(t.innerXml(e))}else if(l){if(l>1)n=t.escape(t.innerXml(e));else for(var a=e.firstChild;a;a=a.nextSibling)n["#cdata"]=t.escape(a.nodeValue)}}if(!e.attributes.length&&!e.firstChild)n=null}else if(e.nodeType==9){n=t.toObj(e.documentElement)}else alert("unhandled node type: "+e.nodeType);return n},toJson:function(e,n,i){var r=n?'"'+n+'"':"";if(e instanceof Array){for(var l=0,o=e.length;l<o;l++)e[l]=t.toJson(e[l],"",i+"\t");r+=(n?":[":"[")+(e.length>1?"\n"+i+"\t"+e.join(",\n"+i+"\t")+"\n"+i:e.join(""))+"]"}else if(e==null)r+=(n&&":")+"null";else if(typeof e=="object"){var a=[];for(var f in e)a[a.length]=t.toJson(e[f],f,i+"\t");r+=(n?":{":"{")+(a.length>1?"\n"+i+"\t"+a.join(",\n"+i+"\t")+"\n"+i:a.join(""))+"}"}else if(typeof e=="string")r+=(n&&":")+'"'+e.toString()+'"';else r+=(n&&":")+e.toString();return r},innerXml:function(e){var n="";if("innerHTML"in e)n=e.innerHTML;else{var t=function(e){var n="";if(e.nodeType==1){n+="<"+e.nodeName;for(var i=0;i<e.attributes.length;i++)n+=" "+e.attributes[i].nodeName+'="'+(e.attributes[i].nodeValue||"").toString()+'"';if(e.firstChild){n+=">";for(var r=e.firstChild;r;r=r.nextSibling)n+=t(r);n+="</"+e.nodeName+">"}else n+="/>"}else if(e.nodeType==3)n+=e.nodeValue;else if(e.nodeType==4)n+="<![CDATA["+e.nodeValue+"]]>";return n};for(var i=e.firstChild;i;i=i.nextSibling)n+=t(i)}return n},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var n=e.firstChild;n;){if(n.nodeType==3){if(!n.nodeValue.match(/[^ \f\n\r\t\v]/)){var i=n.nextSibling;e.removeChild(n);n=i}else n=n.nextSibling}else if(n.nodeType==1){t.removeWhite(n);n=n.nextSibling}else n=n.nextSibling}return e}};if(e.nodeType==9)e=e.documentElement;var i=t.toJson(t.toObj(t.removeWhite(e)),e.nodeName,"\t");return"{\n"+n+(n?i.replace(/\t/g,n):i.replace(/\t|\n/g,""))+"\n}"}