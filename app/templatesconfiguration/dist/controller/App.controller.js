sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel"],function(e,t){"use strict";return e.extend("shapein.TemplatesConfiguration.controller.App",{onInit:function(){var e,a,n=this.getView().getBusyIndicatorDelay();e=new t({busy:true,delay:0});this.setModel(e,"appView");a=function(){};this.getOwnerComponent().getModel().metadataLoaded().then(a);this.getOwnerComponent().getModel().attachMetadataFailed(a);this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass());this.fill_Business_Process();this.call_Templates()},fill_Parser:function(){var e=this.getOwnerComponent().getModel();var t=this.getOwnerComponent().getModel("jerarquia");var a=this.getOwnerComponent().getModel("xsd");var n=this;var s=[];var r=new sap.ui.model.Filter("xsd_id",sap.ui.model.FilterOperator.EQ,"GET_WORKERS_35.2");s.push(r);var i="/Di_Parser_Xsd_Definition";e.read(i,{filters:s,success:function(e,s){var r=e.results;delete e.__metadata;var i=n.getModel("RawModel");i.setData(r);var o=n.pasaratree(r);a.setData(o);t.setData({nodeRoot:{nodes:o}})},error:function(e){}})},pasaratree:function(e,t,a){a=typeof a!=="undefined"?a:[];t=typeof t!=="undefined"?t:{node_id:0};var n=e.filter(function(e){if(e.parent_id===t.node_id){return true}else{return false}});var s=this;if(n.length>0){if(t.node_id===0){a=n}else{t["nodes"]=n}n.forEach(function(t){s.pasaratree(e,t)})}return a},call_Templates:function(){var e=this.getModel("appView");var t=this.getOwnerComponent().getModel();var a=this.getOwnerComponent().getModel("templates_pers");var n=this;var s="/Di_Template";t.read(s,{urlParameters:{$expand:"planning"},success:function(e,t){var s=e.results;delete e.__metadata;a.setData(s);a.refresh();n.call_Templates_Pd()},error:function(t){e.setProperty("/busy",false)}})},fill_Business_Process:function(){var e=this.getOwnerComponent().getModel();var t=this.getOwnerComponent().getModel("BProcess");var a=this;var n="/Di_Business_Process";e.read(n,{urlParameters:{$expand:"templates"},success:function(e,a){var n=e.results;delete e.__metadata;for(var s=0;s<n.length;s++){n[s].templates=n[s].templates.results}t.setData(n)},error:function(e){}})},call_Templates_Pd:function(){var e=this.getOwnerComponent().getModel("templates_pers");var t=e.getData();var a=this.getModel("appView");var n=this.getOwnerComponent().getModel("templates");var s="/CPI-WD2PD_Dest/di/templates/templates_pd";if(this.getOwnerComponent().settings){var r=this.getOwnerComponent().settings.find(e=>e.code==="Customer-Code");var i=this.getOwnerComponent().settings.find(e=>e.code==="Customer-Client_Id");var o=this.getOwnerComponent().settings.find(e=>e.code==="Customer-Scope");jQuery.ajax({url:s,beforeSend:function(e){e.setRequestHeader("Customer-Code",r.value);e.setRequestHeader("Customer-Client_Id",i.value);e.setRequestHeader("Customer-Scope",o.value)},type:"GET",dataType:"json",success:function(e){for(var s=0;s<e.length;s++){var r=String(e[s].active_version);var i=t.find(t=>t.template_id===e[s].id&&t.template_version===r);if(i){e[s].planned="";if(i.planning){if(i.planning.enable){e[s].planned="X"}}e[s].active=i.active;e[s].exist_pers="X";e[s].exist_PD="X";e[s].uuid=i.uuid}else{e[s].planned="";e[s].active=false;e[s].exist_pers="";e[s].exist_PD="X";e[s].uuid=""}}for(var o=0;o<t.length;o++){var r=String(t[o].template_version);var i=e.find(e=>e.id===t[o].template_id&&e.active_version==r);if(!i){var l={};l.planned="";if(t[o].planning){if(t[o].planning.enable){l.planned="X"}}l.active_version=t[o].template_version;l.active=t[o].active;l.exist_pers="X";l.description=t[o].description;l.id=t[o].template_id;l.locale=t[o].language;l.title=t[o].doc_title;l.format=t[o].format;l.updated_at=t[o].updated_at;l.exist_PD="";e.push(l)}}n.setData(e);n.refresh();a.setProperty("/busy",false)},error:function(e){a.setProperty("/busy",false)}})}}})});