sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/model/xml/XMLModel","../model/formatter","../libs/x2js/xml2json","sap/ui/core/Fragment","sap/ui/core/routing/History"],function(e,t,a,s,i,r,n){"use strict";var l=1;var o;return e.extend("shapein.TemplatesConfiguration.controller.Object",{formatter:s,onInit:function(){var e,s=new t({busy:true,delay:0});this.template_id="";this.format="";this.updated_at="";this.template_version="";this.template_language="";this.selectedVar="";this.selectedVarMeta="";this.selectedAttr="";this.description="";this.oldBP="";this.partiallySel=false;this.partiallySelMeta=false;this.oldKey="";this.oldDType="";this.oldTitle="";this.exist_plan="";this.exist_plan_Rep="";this.editIndex=0;this.oldExpDate="";this.stepCoordenates=1;this.buttonIdSel="";this.pathButtonSel="";this.code_id_filled="";this.sourceGVEdit="";this.oldFilters=[];this.oSemanticPage=this.byId("pageSemantic");this.showCustomActions(false);this.getRouter().getRoute("object").attachPatternMatched(this._onObjectMatched,this);e=this.getView().getBusyIndicatorDelay();this.setModel(s,"objectView");var i=this.getModel("template");this.getView().setModel(i,"template");this.getOwnerComponent().getModel().metadataLoaded().then(function(){s.setProperty("/delay",e)});var r=new a;var n=new t;var l=[];var o={};for(var d=0;d<31;d++){var o={};o.text=d+1;o.key=o.text;l.push(o)}o={};o.text="Last Day";o.key="last_day";l.push(o);n.setData(l);this.setModel(n,"days");var u=this.getOwnerComponent().getModel("timezones");u.setSizeLimit(1e3)},onShareInJamPress:function(){var e=this.getModel("objectView"),t=sap.ui.getCore().createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:location.href,share:e.getProperty("/shareOnJamTitle")}}});t.open()},_onObjectMatched:function(e){this.initModels();var t=this.getModel("objectView");t.setProperty("/busy",true);var a=e.getParameter("arguments").objectId;var s=e.getParameter("arguments").version;var i="templates/"+a+","+s;var r=this.getModel("templates");var n=r.getData();if(!Array.isArray(n)){this.sleep(7e3).then(()=>{this._bindView(a,s)})}else{this._bindView(a,s)}},sleep:function(e){return new Promise(t=>setTimeout(t,e))},_bindView:function(e,t){var a=this.getModel("objectView"),s=this.getModel("templates"),i=this.getModel("header"),r=this.getModel("template"),n=this.getModel("filters"),l=this.getModel("attributes"),o=this.getModel("planning"),d=this.getModel("planningRep"),u=this.getModel("signature"),g=this.getModel("globalVar"),p=this.getModel("doctypes");var c=s.getData();var h=String(t);var f=c.find(t=>t.id===e&&t.active_version==h);this.template_id=f.id;this.template_version=f.active_version;this.template_language=f.locale;this.format=f.format;this.updated_at=f.updated_at;this.description=f.description;var v=this.getOwnerComponent().getModel();var b=this;var m=[];var y=new sap.ui.model.Filter("template_id",sap.ui.model.FilterOperator.EQ,f.id);var _=new sap.ui.model.Filter("template_version",sap.ui.model.FilterOperator.EQ,f.active_version);m.push(y);m.push(_);a.refresh();var I={};var V="/Di_Template";v.read(V,{filters:m,success:function(e,t){var s=e.results[0];delete e.__metadata;if(s){var c=V+"(guid'"+s.uuid+"')";I.uuid=s.uuid;I.id=s.template_id;I.version=s.template_version;I.description=f.description;I.language=f.locale;I.signature=s.signature;I.active=s.active;I.deprecated=s.deprecated;if(I.active){b.oldKey="A"}else{b.oldKey="I"}I.doc_type=s.doc_type_id;b.oldDocType=s.doc_type_id;I.title=s.doc_title;var h=b.getOwnerComponent().getModel("BProcess").getData();if(Array.isArray(h)){var m=h.find(e=>e.bpt_id===s.bpt_id);I.business_process_text=m.name}I.business_process=s.bpt_id;b.oldBP=I.business_process;b.oldTitle=I.title;b.oldDType=I.doc_type;i.setData(I);i.refresh();v.read(c,{urlParameters:{$expand:"business_process,pages,mappings,sign_cfg,planning/integs_plan_d,planning/adata,planning_rep/integs_plan_d,planning_rep/adata,attributes/values_attr"},success:function(e,t){var a=e;var s=a.planning;var i=a.planning_rep;var r=a.sign_cfg;if(s){b.exist_plan="X";if(s.enable){s.enable="A"}else{s.enable="U"}s.adata=a.planning.adata.results;s.plan_d=a.planning.integs_plan_d.results[0];c=V+"/begda";var p=s.plan_d.begda;var h=String(p.getMonth()+1);if(h<10){h="0"+String(h)}var v=String(p.getDate());if(v<10){v="0"+String(v)}var m=p.getFullYear()+"-"+h+"-"+v;s.plan_d.begda=m;var y=s.plan_d.endda;var _=String(y.getMonth()+1);if(_<10){_="0"+String(_)}var I=String(y.getDate());if(I<10){I="0"+String(I)}var M=y.getFullYear()+"-"+_+"-"+I;s.plan_d.endda=M;var w=sap.ui.core.format.DateFormat.getTimeInstance({pattern:"HH:mm:ss"});var S=new Date(0).getTimezoneOffset()*60*1e3;var C=w.format(new Date(s.plan_d.time_start.ms+S));s.plan_d.time_start=C;var T=w.format(new Date(s.plan_d.time_end.ms+S));s.plan_d.time_end=T;s.plan_d.time_frecuency=s.plan_d.time_frecuency+s.plan_d.time_measure;var P={};s.adata.forEach(function(e){delete e.__metadata;switch(e.level2){case"TIME_ZONE":P.time_zone=e.value;P.time_zone_uuid=e.uuid;P.planning_uuid=e.planning_uuid;break;case"INITIAL_DATE_FROM":P.initial_date_from=e.value;P.initial_date_from_uuid=e.uuid;break;case"RETRO_CHG_EFFECTIVE_FROM":P.retro_effec_from=e.value;P.retro_effec_from_uuid=e.uuid;break;case"FUTURE_CHG_UPDATED_FROM":P.fut_upd_from=e.value;P.fut_upd_from_uuid=e.uuid;break;case"NEXT_UPDATED_FROM":P.next_upd_from=e.value;P.next_upd_from_uuid=e.uuid;break;default:}});s.adata=P}else{b.exist_plan="";var D={execute:true,begda:"2020-01-01",endda:"9999-12-31",periodicity_type:"W",ontime:false,periodicity_values:"2-4-6",time_frecuency:"1m",time_start:"00:00:00",time_end:"23:59:00",time_zone:"UTC"};s={comments:"",enable:"U"};s.plan_d=D;s.adata=[]}if(i){b.exist_plan_Rep="X";if(i.enable){i.enable="A"}else{i.enable="U"}i.plan_d=a.planning_rep.integs_plan_d.results[0];c=V+"/begda";var p=i.plan_d.begda;var h=String(p.getMonth()+1);if(h<10){h="0"+String(h)}var v=String(p.getDate());if(v<10){v="0"+String(v)}var m=p.getFullYear()+"-"+h+"-"+v;i.plan_d.begda=m;var y=i.plan_d.endda;var _=String(y.getMonth()+1);if(_<10){_="0"+String(_)}var I=String(y.getDate());if(I<10){I="0"+String(I)}var M=y.getFullYear()+"-"+_+"-"+I;i.plan_d.endda=M;var w=sap.ui.core.format.DateFormat.getTimeInstance({pattern:"HH:mm:ss"});var S=new Date(0).getTimezoneOffset()*60*1e3;var C=w.format(new Date(i.plan_d.time_start.ms+S));i.plan_d.time_start=C;var T=w.format(new Date(i.plan_d.time_end.ms+S));i.plan_d.time_end=T;i.plan_d.time_frecuency=i.plan_d.time_frecuency+i.plan_d.time_measure;var P={}}else{b.exist_plan_Rep="";var D={execute:true,begda:"2020-01-01",endda:"9999-12-31",periodicity_type:"W",ontime:false,periodicity_values:"2-4-6",time_frecuency:"1m",time_start:"00:00:00",time_end:"23:59:00",time_zone:"UTC"};i={comments:"",enable:"U"};i.plan_d=D}var B=a.attributes.results;var x=[];var E=[];if(B){for(var A=0;A<B.length;A++){var R={uuid:B[A].uuid,name:B[A].name,description:B[A].description,path:B[A].xpath,sign:B[A].sign};x.push(R);for(var O=0;O<B[A].values_attr.results.length;O++){var N={uuid:B[A].values_attr.results[O].uuid,attr_uuid:B[A].uuid,name:B[A].name,description:B[A].description,path:B[A].xpath,value:B[A].values_attr.results[O].value};E.push(N);var F=Object.assign({},N);b.oldFilters.push(F)}}}if(r){var j=JSON.parse(r.json_cfg);j.uuid=r.uuid}else{var j={};j.uuid="";j.signers=[]}u.setData(j);u.refresh();n.setData(E);n.refresh();l.setData(x);l.refresh();o.setData(s);o.refresh();d.setData(i);d.refresh();var G=[];var q=[];var k=[];for(var A=0;A<a.mappings.results.length;A++){if(a.mappings.results[A].mapping_object=="TEMPL_MAPP"){q.push(a.mappings.results[A])}else if(a.mappings.results[A].mapping_object=="GLOBAL_VAR"){G.push(a.mappings.results[A])}else if(a.mappings.results[A].mapping_object=="DOCID_META"){k.push(a.mappings.results[A])}}a.mappings=q;a.metadata=k;g.setData(G);g.refresh();a.business_process=a.business_process.results;delete e.__metadata;b.call_Template_details(a,f,"")},error:function(e){a.setProperty("/busy",false)}})}else{var y="/CPI-WD2PD_Dest/di/templates/template/detail";var _=sap.ui.getCore().getConfiguration().getLanguage();var M=_+"-"+_;y=y+"?Template-Id="+f.id+"&Template-Version="+f.active_version+"&Template-Language="+M;if(b.getOwnerComponent().settings){var w=b.getOwnerComponent().settings.find(e=>e.code==="Customer-Code");var S=b.getOwnerComponent().settings.find(e=>e.code==="Customer-Client_Id");var C=b.getOwnerComponent().settings.find(e=>e.code==="Customer-Scope");jQuery.ajax({url:y,beforeSend:function(e){e.setRequestHeader("Customer-Code",w.value);e.setRequestHeader("Customer-Client_Id",S.value);e.setRequestHeader("Customer-Scope",C.value);e.setRequestHeader("Template-Return-Preview",true)},type:"GET",dataType:"json",success:function(e){p.setData(e.employee_doctypes_assigned);p.refresh();if(e.pages_preview){for(var t=0;t<e.pages_preview.length;t++){e.pages_preview[t].base64="data:image/png;base64,"+e.pages_preview[t].base64}}else{e.pages_preview=[]}for(var s=0;s<e.variables.length;s++){e.variables[s].path="";e.variables[s].map=""}e.id=f.id;e.description=f.description;e.title=f.title;e.updated_at=f.updated_at;e.deprecated=f.deprecated;e.base64="";r.setData(e);r.refresh();a.setProperty("/busy",false);var i=e.variables.length;b.getView().byId("tabMap").setCount(i);b.configNewTemp()},error:function(e){a.setProperty("/busy",false);var t=JSON.parse(e.responseText).message_error.substring(66);sap.m.MessageToast.show(t)}})}}},error:function(e){a.setProperty("/busy",false)}})},refreshObjectsTemplate:function(e,t,a){var s=this.getModel("objectView"),i=this.getModel("templates"),r=this.getModel("header"),n=this.getModel("template"),l=this.getModel("filters"),o=this.getModel("attributes"),d=this.getModel("planning"),u=this.getModel("planningRep"),g=this.getModel("signature"),p=this.getModel("globalVar"),c=this.getModel("doctypes");var h=this.getOwnerComponent().getModel();var f=i.getData();var v="/Di_Template";var b=this;var m=v+"(guid'"+e+"')";h.read(m,{urlParameters:{$expand:"business_process,mappings,sign_cfg,planning/integs_plan_d,planning/adata,planning_rep/integs_plan_d,planning_rep/adata,attributes/values_attr"},success:function(s,i){var r=s;var n=r.planning;var c=r.planning_rep;var h=r.sign_cfg;if(n){b.exist_plan="X";if(n.enable){n.enable="A"}else{n.enable="U"}n.adata=r.planning.adata.results;n.plan_d=r.planning.integs_plan_d.results[0];m=v+"/begda";var y=n.plan_d.begda;var _=String(y.getMonth()+1);if(_<10){_="0"+String(_)}var I=String(y.getDate());if(I<10){I="0"+String(I)}var V=y.getFullYear()+"-"+_+"-"+I;n.plan_d.begda=V;var M=n.plan_d.endda;var w=String(M.getMonth()+1);if(w<10){w="0"+String(w)}var S=String(M.getDate());if(S<10){S="0"+String(S)}var C=M.getFullYear()+"-"+w+"-"+S;n.plan_d.endda=C;n.plan_d.time_frecuency=n.plan_d.time_frecuency+n.plan_d.time_measure;var T=sap.ui.core.format.DateFormat.getTimeInstance({pattern:"HH:mm:ss"});var P=new Date(0).getTimezoneOffset()*60*1e3;var D=T.format(new Date(n.plan_d.time_start.ms+P));n.plan_d.time_start=D;var B=T.format(new Date(n.plan_d.time_end.ms+P));n.plan_d.time_end=B;var x={};n.adata.forEach(function(e){delete e.__metadata;switch(e.level2){case"TIME_ZONE":x.time_zone=e.value;x.time_zone_uuid=e.uuid;x.planning_uuid=e.planning_uuid;break;case"INITIAL_DATE_FROM":x.initial_date_from=e.value;x.initial_date_from_uuid=e.uuid;break;case"RETRO_CHG_EFFECTIVE_FROM":x.retro_effec_from=e.value;x.retro_effec_from_uuid=e.uuid;break;case"FUTURE_CHG_UPDATED_FROM":x.fut_upd_from=e.value;x.fut_upd_from_uuid=e.uuid;break;case"NEXT_UPDATED_FROM":x.next_upd_from=e.value;x.next_upd_from_uuid=e.uuid;break;default:}});n.adata=x}else{b.exist_plan="";var E={execute:true,begda:"2020-01-01",endda:"9999-12-31",periodicity_type:"W",ontime:false,periodicity_values:"2-4-6",time_frecuency:"1m",time_start:"00:00:00",time_end:"23:59:00",time_zone:"UTC"};n={comments:"",enable:"U"};n.plan_d=E;n.adata=[]}if(c){b.exist_plan_Rep="X";if(c.enable){c.enable="A"}else{c.enable="U"}c.adata=r.planning_rep.adata.results;c.plan_d=r.planning_rep.integs_plan_d.results[0];m=v+"/begda";var y=c.plan_d.begda;var _=String(y.getMonth()+1);if(_<10){_="0"+String(_)}var I=String(y.getDate());if(I<10){I="0"+String(I)}var V=y.getFullYear()+"-"+_+"-"+I;c.plan_d.begda=V;c.plan_d.time_frecuency=c.plan_d.time_frecuency+c.plan_d.time_measure;var M=c.plan_d.endda;var w=String(M.getMonth()+1);if(w<10){w="0"+String(w)}var S=String(M.getDate());if(S<10){S="0"+String(S)}var C=M.getFullYear()+"-"+w+"-"+S;c.plan_d.endda=C;var T=sap.ui.core.format.DateFormat.getTimeInstance({pattern:"HH:mm:ss"});var P=new Date(0).getTimezoneOffset()*60*1e3;var D=T.format(new Date(c.plan_d.time_start.ms+P));c.plan_d.time_start=D;var B=T.format(new Date(c.plan_d.time_end.ms+P));c.plan_d.time_end=B;var x={};c.adata.forEach(function(e){delete e.__metadata;switch(e.level2){case"TIME_ZONE":x.time_zone=e.value;x.time_zone_uuid=e.uuid;x.planning_uuid=e.planning_uuid;break;case"INITIAL_DATE_FROM":x.initial_date_from=e.value;x.initial_date_from_uuid=e.uuid;break;case"RETRO_CHG_EFFECTIVE_FROM":x.retro_effec_from=e.value;x.retro_effec_from_uuid=e.uuid;break;case"FUTURE_CHG_UPDATED_FROM":x.fut_upd_from=e.value;x.fut_upd_from_uuid=e.uuid;break;case"NEXT_UPDATED_FROM":x.next_upd_from=e.value;x.next_upd_from_uuid=e.uuid;break;default:}});c.adata=x}else{b.exist_plan_Rep="";var E={execute:true,begda:"2020-01-01",endda:"9999-12-31",periodicity_type:"W",ontime:false,periodicity_values:"2-4-6",time_frecuency:"1m",time_start:"00:00:00",time_end:"23:59:00",time_zone:"UTC"};c={comments:"",enable:"U"};c.plan_d=E;c.adata=[]}var A=r.attributes.results;var R=[];var O=[];if(A){for(var N=0;N<A.length;N++){var F={uuid:A[N].uuid,name:A[N].name,description:A[N].description,path:A[N].xpath,sign:A[N].sign};R.push(F);for(var j=0;j<A[N].values_attr.results.length;j++){var G={uuid:A[N].values_attr.results[j].uuid,attr_uuid:A[N].uuid,name:A[N].name,description:A[N].description,path:A[N].xpath,value:A[N].values_attr.results[j].value};O.push(G)}}}if(h){var q=JSON.parse(h.json_cfg);q.uuid=h.uuid}else{var q={};q.uuid="";q.signers=[]}g.setData(q);g.refresh();l.setData(O);l.refresh();o.setData(R);o.refresh();d.setData(n);d.refresh();u.setData(c);u.refresh();var k=[];var X=[];var K=[];for(var N=0;N<r.mappings.results.length;N++){if(r.mappings.results[N].mapping_object=="TEMPL_MAPP"){X.push(r.mappings.results[N])}else if(r.mappings.results[N].mapping_object=="GLOBAL_VAR"){k.push(r.mappings.results[N])}else if(r.mappings.results[N].mapping_object=="DOCID_META"){K.push(r.mappings.results[N])}}r.mappings=X;r.metadata=K;p.setData(k);p.refresh();r.business_process=r.business_process.results;delete s.__metadata;var L=f.find(e=>e.id===b.template_id&&e.active_version==b.template_version);if(t&&a){b.call_Template_details(r,L,"X","X",e)}else if(t&&!a){b.call_Template_details(r,L,"X","",e)}else if(!t&&a){b.call_Template_details(r,L,"","X",e)}else{b.call_Template_details(r,L,"","")}},error:function(e){s.setProperty("/busy",false)}})},getSubscriptionSettings:async function(){var e=this.getOwnerComponent().getModel();var t="/Subscription_Settings";var a=[];e.read(t,{success:function(e,t){var s=e.results;for(var i=0;i<s.length;i++){var r={code:s[i].code,value:s[i].value};a.push(r)}return a},error:function(e){return a}})},checkMappings:function(e){this.byId("tableChecks").setBusy(true);var t=e.getSource().getParent();var a=[this.byId("CheckEmployee")],s=false;a.forEach(function(e){s=this._validateInputNewP(e)||s},this);if(s){sap.m.MessageBox.alert("A validation error has occurred.");this.byId("tableChecks").setBusy(false);return}var i=this.getModel("template");var r=this.getModel("checkMap");var n=r.getData();var l=i.getData().variables;var o=[];var d=this;for(var u=0;u<n.length;u++){if(n[u].path!=""){var g={variable:n[u].variable,mapping:n[u].path,source:n[u].source,mapping_object:"TEMPL_MAPP"};o.push(g)}}var p="/CPI-WD2PD_Dest/di/templates/template/mapping_test";if(this.getOwnerComponent().settings){var c=this.getOwnerComponent().settings.find(e=>e.code==="Customer-Code");var h=this.getOwnerComponent().settings.find(e=>e.code==="Customer-Client_Id");var f=this.getOwnerComponent().settings.find(e=>e.code==="Customer-Scope");var v=a[0].getValue();var b={mockdata:{employee_id:v,ws_response:null},mapping:o};var m=JSON.stringify(b);jQuery.ajax({url:p,type:"POST",beforeSend:function(e){e.setRequestHeader("Customer-Code",c.value);e.setRequestHeader("Customer-Client_Id",h.value);e.setRequestHeader("Customer-Scope",f.value)},dataType:"json",contentType:"application/json",data:m,success:function(e){var t=[];for(var a=0;a<e.mapping_result.length;a++){var s=n.find(t=>t.variable===e.mapping_result[a].variable);var i={variable:e.mapping_result[a].variable,error:"",value:e.mapping_result[a].value,path:s.path,source:s.source};t.push(i)}for(var a=0;a<e.mapping_error.length;a++){var l=n.find(t=>t.variable===e.mapping_result[a].variable);var o={variable:e.mapping_error[a].variable,error:"X",value:e.mapping_error[a].value,path:l.path,source:l.source};t.push(o)}r.setData(t);r.refresh();d.byId("tableChecks").setBusy(false)},error:function(e){var t=n;var a=[];for(var s=0;s<t.length;s++){if(t[s].path!=""){var i={variable:t[s].variable,error:"C",path:t[s].path,source:t[s].source,value:""};a.push(i)}}r.setData(a);r.refresh();var l=JSON.parse(e.responseText).message_error.substring(66);sap.m.MessageToast.show(l);d.byId("tableChecks").setBusy(false)}})}},call_Template_details:function(e,t,a,s,i){var r=this.getModel("objectView"),n=this.getModel("template"),l=this.getModel("header"),o=this.getModel("doctypes"),d=this.getModel("signtypes");var u=this;var g=l.getData();var p="/CPI-WD2PD_Dest/di/templates/template/detail";var c=sap.ui.getCore().getConfiguration().getLanguage();var h=c+"-"+c;p=p+"?Template-Id="+t.id+"&Template-Version="+t.active_version+"&Template-Language="+h;if(this.getOwnerComponent().settings){var f=false;if(e.pages.results.length==0){f=true}var v=this.getOwnerComponent().settings.find(e=>e.code==="Customer-Code");var b=this.getOwnerComponent().settings.find(e=>e.code==="Customer-Client_Id");var m=this.getOwnerComponent().settings.find(e=>e.code==="Customer-Scope");jQuery.ajax({url:p,beforeSend:function(e){e.setRequestHeader("Customer-Code",v.value);e.setRequestHeader("Customer-Client_Id",b.value);e.setRequestHeader("Customer-Scope",m.value);e.setRequestHeader("Template-Return-Preview",f)},type:"GET",dataType:"json",success:function(p){o.setData(p.employee_doctypes_assigned);o.refresh();if(e.sign_cfg){var c=JSON.parse(e.sign_cfg.json_cfg);var h=p.signature_types.find(e=>e.id===c.signature_type);if(!h){var v={id:"",title:"",backend_code:"",delegation:false};p.signature_types.unshift(v)}}d.setData(p.signature_types);d.refresh();var b=p.employee_doctypes_assigned;var m=[];if(Array.isArray(b)){var y=b.find(t=>t.id===e.doc_type_id);if(y){g.doc_type_text=y.label;l.setData(g);l.refresh();if(y.metadata&&Array.isArray(y.metadata)){for(var _=0;_<y.metadata.length;_++){y.metadata[_].dtype_id=y.id;m.push(y.metadata[_])}}}}p.metadata=m;o.refresh();if(f){if(p.pages_preview){for(var I=0;I<p.pages_preview.length;I++){p.pages_preview[I].base64="data:image/png;base64,"+p.pages_preview[I].base64}}else{p.pages_preview=[]}}else{p.pages_preview=e.pages.results;p.pages_preview.sort(function(e,t){return e.page-t.page});if(p.pages_preview){for(var I=0;I<p.pages_preview.length;I++){p.pages_preview[I].base64=p.pages_preview[I].content;delete p.pages_preview[I].content}}else{p.pages_preview=[]}}if(e.mappings){for(var _=0;_<p.variables.length;_++){var V=e.mappings.find(e=>e.variable===p.variables[_].slug);if(V){p.variables[_].source=V.source;p.variables[_].path=V.mapping;if(p.variables[_].path===""){p.variables[_].map=""}else{p.variables[_].map="X"}}else{p.variables[_].path="";p.variables[_].map="";p.variables[_].source=""}}}if(e.metadata){for(var _=0;_<p.metadata.length;_++){var M=e.metadata.find(e=>e.variable===p.metadata[_].code);if(M){p.metadata[_].source=M.source;p.metadata[_].path=M.mapping;if(p.metadata[_].path===""){p.metadata[_].map=""}else{p.metadata[_].map="X"}}else{p.metadata[_].path="";p.metadata[_].map="";p.metadata[_].source=""}}}p.id=t.id;p.description=t.description;p.title=t.title;p.updated_at=t.updated_at;p.deprecated=t.deprecated;p.base64="";n.setData(p);n.refresh();r.setProperty("/busy",false);var w=p.variables.length;u.getView().byId("tabMap").setCount(w);if(a==="X"){u.deleteOldMappingsCreateMappings(i,"X")}if(s==="X"){u.deleteOldMappingsCreateMappingsMeta(i,"X")}if(u.byId("tablemeta").getBusy()){u.byId("tablemeta").setBusy(false)}if(f){u.createPagesBatch(e.uuid)}},error:function(e){r.setProperty("/busy",false)}})}},openValues:function(e){var t=e.getSource().getParent().getBindingContext("attributes").getPath()+"/name";var a=this.getView().getModel("attributes").getProperty(t);var s=e.getSource().getParent().getBindingContext("attributes").getPath()+"/uuid";this.selectedAttr=this.getView().getModel("attributes").getProperty(s);var i=this.getModel("filters");var n=new sap.ui.model.Filter("attr_uuid",sap.ui.model.FilterOperator.EQ,this.selectedAttr);var l=i.getData();if(!this.byId("manageValues")){r.load({id:this.getView().getId(),name:"shapein.TemplatesConfiguration.view.fragments.manageValues",controller:this}).then(function(e){this.getView().addDependent(e);this.byId("tableFilHeader").setText(a);this.byId("tablefil").getBinding("items").filter([n]);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());e.open()}.bind(this))}else{this.byId("tablefil").getBinding("items").filter([n]);this.byId("tableFilHeader").setText(a);this.byId("manageValues").open()}},addSigner:function(e){var t=this.getModel("signer");var a=t.getData();a={type:"organization"};t.setData(a);t.refresh();if(!this.byId("newSigner")){r.load({id:this.getView().getId(),name:"shapein.TemplatesConfiguration.view.fragments.newSigner",controller:this}).then(function(e){this.getView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());e.open()}.bind(this))}else{this.byId("newSigner").open()}},displaySigner:function(e){var t=this.getModel("signer");var a=e.getSource().getParent().getParent().getBindingContext("signature").getPath();var s=this.getView().getModel("signature");var i=s.getProperty(a);t.setData(i);t.refresh();if(!this.byId("dispSigner")){r.load({id:this.getView().getId(),name:"shapein.TemplatesConfiguration.view.fragments.dispSigner",controller:this}).then(function(e){this.getView().addDependent(e);var t=this.byId("Signature_Type_Dis").getItemByKey(i.type);var a={selectedItem:t};this.byId("Signature_Type_Dis").fireChange(a);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());e.open()}.bind(this))}else{var n=this.byId("Signature_Type_Dis").getItemByKey(i.type);var l={selectedItem:n};this.byId("Signature_Type_Dis").fireChange(l);this.byId("dispSigner").open()}},editSigner:function(e){var t=this.getModel("signer");var a=e.getSource().getParent().getParent().getBindingContext("signature").getPath();var s=this.getModel("signature");var i=s.getData();let n=Object.assign({},s.getProperty(a));t.setData(n);t.refresh();var l=a.split("/");var o=parseInt(l[l.length-1]);this.editIndex=o;if(!this.byId("editSigne")){r.load({id:this.getView().getId(),name:"shapein.TemplatesConfiguration.view.fragments.editSigne",controller:this}).then(function(e){this.getView().addDependent(e);var t=this.byId("Signature_Type_Edit").getItemByKey(n.type);var a={selectedItem:t};this.byId("Signature_Type_Edit").fireChange(a);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());e.open()}.bind(this))}else{var d=this.byId("Signature_Type_Edit").getItemByKey(n.type);var u={selectedItem:d};this.byId("Signature_Type_Edit").fireChange(u);this.byId("editSigne").open()}},onCheckMap:function(e){var t=this.getModel("checkMap");var a=t.getData();var s=this.getModel("template");var i=s.getData().variables;var n=[];var l=this;for(var o=0;o<i.length;o++){if(i[o].path!=""){var d={variable:i[o].slug,path:i[o].path,source:i[o].source,error:"C",value:""};n.push(d)}}t.setData(n);t.refresh();if(!this.byId("checkMap")){r.load({id:this.getView().getId(),name:"shapein.TemplatesConfiguration.view.fragments.checkMappings",controller:this}).then(function(e){this.getView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());e.setTitle("Check Mappings");this.byId("tableChecks").setNoDataText("No Mapping Checks");e.open()}.bind(this))}else{this.byId("CheckEmployee").setValue("");this.byId("CheckEmployee").setValueState("None");this.byId("checkMap").setTitle("Check Mappings");this.byId("tableChecks").setNoDataText("No Mapping Checks");this.byId("checkMap").open()}},onCheckMapMeta:function(e){var t=this.getModel("checkMap");var a=t.getData();var s=this.getModel("template");var i=s.getData().metadata;var n=[];var l=this;for(var o=0;o<i.length;o++){if(i[o].path!=""){var d={variable:i[o].code,path:i[o].path,source:i[o].source,error:"C",value:""};n.push(d)}}t.setData(n);t.refresh();if(!this.byId("checkMap")){r.load({id:this.getView().getId(),name:"shapein.TemplatesConfiguration.view.fragments.checkMappings",controller:this}).then(function(e){this.getView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());this.byId("tableChecks").setNoDataText("No Metadata Checks");e.setTitle("Check Metadata");e.open()}.bind(this))}else{this.byId("CheckEmployee").setValue("");this.byId("CheckEmployee").setValueState("None");this.byId("checkMap").setTitle("Check Metadata");this.byId("tableChecks").setNoDataText("No Metadata Checks");this.byId("checkMap").open()}},pressPage:function(e){this.byId("cancelBtnCoord").setVisible(false);var t=e.getSource().getSrc();var a=e.getSource().getParent().getActivePage();var s=a.split("-");var i=parseInt(s[s.length-1]);var a=i+1;this.byId("carouselContainerCoordenates").setVisible(false);var r=this.byId("carouselContainerCoordenates").getPages().length;if(a==r){a=""}this.byId("imagePage").setVisible(true);var n=this.byId("imagePage");this.stepCoordenates=2;this.byId("ScrollCoordenates").scrollTo(0,0);this.byId("messageCoord").setText("2. Click in lower left corner field sign.");n.setSrc(t);var l=this.getModel("signer");var o=l.getData();var d={page:a};o.generate_pdf_sign_field=Object.assign({},d);l.setData(o);l.refresh()},selectCoordenates:function(e){var t=this;if(!this.byId("imagen")){r.load({id:this.getView().getId(),name:"shapein.TemplatesConfiguration.view.fragments.imageSign",controller:this}).then(function(e){this.getView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());var t=this;var a=this.byId("imagePage");a.addEventDelegate({onAfterRendering:function(){a.$().click(function(e){var a=t.stepCoordenates;var s=t.getModel("signer");var i=s.getData();if(a==2){var r=$(this).offset();var n=e.pageX-r.left;var l=e.pageY-r.top;var o=Math.round(n);var d=Math.round(this.height-l);t.stepCoordenates=3;t.byId("ScrollCoordenates").scrollTo(0,0);t.byId("messageCoord").setText("3. Click in upper right corner field sign.");i.generate_pdf_sign_field.llx=o;i.generate_pdf_sign_field.lly=d;s.setData(i);s.refresh()}else if(a==3){var r=$(this).offset();var n=e.pageX-r.left;var l=e.pageY-r.top;var u=Math.round(n);var g=Math.round(this.height-l);t.stepCoordenates=1;$(".position").val("afaf");t.byId("carouselContainerCoordenates").setVisible(true);t.byId("imagePage").setVisible(false);t.byId("imagePage").setSrc("");t.byId("messageCoord").setText("1. Click to select Page to sign.");i.generate_pdf_sign_field.urx=u;i.generate_pdf_sign_field.ury=g;s.setData(i);s.refresh();var p=t.byId("imagen");p.close()}})}});var s=this.byId("messageCoord");var i=this.byId("ScrollCoordenates");if(i){jQuery.sap.delayedCall(0,null,function(){i.scrollToElement(s)})}e.open()}.bind(this))}else{var a=this.byId("carouselContainerCoordenates").getPages();this.byId("carouselContainerCoordenates").setActivePage(a[0]);this.byId("cancelBtnCoord").setVisible(true);this.byId("imagen").open();var s=this.byId("messageCoord");var i=this.byId("ScrollCoordenates");if(i){i.scrollToElement(s)}}},cancelImage:function(e){this.byId("carouselContainerCoordenates").setVisible(true);this.byId("imagePage").setVisible(false);this.byId("imagePage").setSrc("");this.stepCoordenates=1;var t=e.getSource().getParent();t.close()},onAddAttr:function(e){if(!this.byId("newAttribute")){r.load({id:this.getView().getId(),name:"shapein.TemplatesConfiguration.view.fragments.newAttribute",controller:this}).then(function(e){this.getView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());e.open()}.bind(this))}else{this.byId("NameAttribu").setValue("");this.byId("DescAttribu").setValue("");this.byId("PathAttribu").setValue("");this.byId("NameAttribu").setValueState("None");this.byId("DescAttribu").setValueState("None");this.byId("PathAttribu").setValueState("None");this.byId("newAttribute").open()}},onAddGlobalVar:function(e){var t=this.getModel("globalVari");var a=t.getData();var s="";var i=e.getSource().getId();if(i.match("addGlobalVar")){s="New";a={variable:"",mapping_type:"EXPRE",mapping:""};this.sourceGVEdit="";t.setData(a);t.refresh()}else{s="Edit";var n=this.getModel("globalVar");var l=e.getSource().getParent().getParent().getBindingContext("globalVar").getPath();var o=l+"/source";var d=n.getData();this.sourceGVEdit=n.getProperty(o);var u=Object.assign({},n.getProperty(l));t.setData(u);t.refresh()}if(!this.byId("globalVariable")){r.load({id:this.getView().getId(),name:"shapein.TemplatesConfiguration.view.fragments.globalVar",controller:this}).then(function(e){this.getView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());if(s=="New"){this.byId("Name_GV").setEnabled(true);e.setTitle("New Global Variable");this.byId("btonAddGV").setVisible(true);this.byId("btonEditGV").setVisible(false)}else{this.byId("Name_GV").setEnabled(false);e.setTitle("Edit Global Variable");this.byId("btonEditGV").setVisible(true);this.byId("btonAddGV").setVisible(false)}e.open()}.bind(this))}else{if(s=="New"){this.byId("Name_GV").setEnabled(true);this.byId("globalVariable").setTitle("New Global Variable");this.byId("btonAddGV").setVisible(true);this.byId("btonEditGV").setVisible(false)}else{this.byId("Name_GV").setEnabled(false);this.byId("globalVariable").setTitle("Edit Global Variable");this.byId("btonEditGV").setVisible(true);this.byId("btonAddGV").setVisible(false)}this.byId("globalVariable").open()}},cancelGVar:function(e){var t=e.getSource().getParent();t.close()},execEditGV:function(e){var t=[this.byId("Name_GV"),this.byId("Value_GV")],a=false;t.forEach(function(e){a=this._validateInputNewP(e)||a},this);if(a){sap.m.MessageBox.alert("A validation error has occurred.");return}var s=this;var i=this.getModel("globalVari");var r=i.getData();var n=r.uuid;var l="Are you sure to edit this global variable?";var o=this.getModel("header");var d=o.getData().uuid;var u="/Di_Template_Mappings(guid'"+n+"')";var g=this.byId("Name_GV").getValue();var p=this.byId("Value_GV").getValue();var c=this.byId("Type_GV").getSelectedKey();var h=null;if(c==="XPATH"){h=this.byId("Source_GV").getValue()}var o=this.getModel("header");var d=o.getData().uuid;var f={variable:g,mapping_object:"GLOBAL_VAR",mapping_type:c,template_uuid:d,source:h,mapping:p};var v=s.getOwnerComponent().getModel();var b=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:l}),beginButton:new sap.m.Button({text:"Yes",press:function(){v.update(u,f,{headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(e,t){s.refreshGlobalVar(d);s.byId("globalVariable").close();sap.m.MessageToast.show("Global Variable updated!!")},error:function(e){sap.m.MessageToast.show("Error")}});b.close()}}),endButton:new sap.m.Button({text:"No",press:function(){b.close()}}),afterClose:function(){b.destroy()}});b.open()},addNewGV:function(e){var t=this.getModel("globalVar");var a=t.getData();var s=[this.byId("Name_GV"),this.byId("Value_GV")],i=false;s.forEach(function(e){i=this._validateInputNewP(e)||i},this);if(i){sap.m.MessageBox.alert("A validation error has occurred.");return}var r=s[0].getValue();var n=a.find(e=>e.variable===r);if(n){sap.m.MessageBox.alert("A global variable with that name already exists.");return}var l=/^[0-9a-zA-Z-_]+$/;if(r.match(l)){}else{sap.m.MessageBox.alert("Only can use alphanumeric characters and _");return}var o=this;var d=this.byId("Name_GV").getValue();var u=this.byId("Value_GV").getValue();var g=this.byId("Type_GV").getSelectedKey();var p=this.getModel("header");var c=p.getData().uuid;var h=null;if(g==="XPATH"){h=this.byId("Source_GV").getValue()}var f={variable:d,mapping_object:"GLOBAL_VAR",mapping_type:g,template_uuid:c,source:h,mapping:u};var v=o.getOwnerComponent().getModel();var b="Are you sure to create a new global variable?";var m=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:b}),beginButton:new sap.m.Button({text:"Yes",press:function(){v.create("/Di_Template_Mappings",f,{headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(e,t){o.refreshGlobalVar(c);o.byId("globalVariable").close();sap.m.MessageToast.show("Global Variable created!!")},error:function(e){sap.m.MessageToast.show("Error")}});m.close()}}),endButton:new sap.m.Button({text:"No",press:function(){m.close()}}),afterClose:function(){m.destroy()}});m.open()},createNewAttr:function(e){var t=[this.byId("NameAttribu"),this.byId("DescAttribu"),this.byId("PathAttribu")],a=false;t.forEach(function(e){a=this._validateInputNewP(e)||a},this);if(a){sap.m.MessageBox.alert("A validation error has occurred.");return}var s=this;var i=this.byId("NameAttribu").getValue();var r=this.byId("DescAttribu").getValue();var n=this.byId("PathAttribu").getValue();var l=this.getModel("header");var o=l.getData().uuid;var d={name:i,description:r,template_uuid:o,sign:"I",xpath:n};var u=s.getOwnerComponent().getModel();var g="Are you sure to create a new attribute?";var p=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:g}),beginButton:new sap.m.Button({text:"Yes",press:function(){u.create("/Di_Template_Worker_Attr",d,{headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(e,t){s.refreshAttribFilters(o);s.byId("newAttribute").close();sap.m.MessageToast.show("Attribute created!!")},error:function(e){sap.m.MessageToast.show("Error")}});p.close()}}),endButton:new sap.m.Button({text:"No",press:function(){p.close()}}),afterClose:function(){p.destroy()}});p.open()},closeDisplaySigner:function(e){var t=e.getSource().getParent();t.close()},cancelNewSigner:function(e){var t=[this.byId("Reg_Reference"),this.byId("Tech_Id"),this.byId("Email_address"),this.byId("Phone_number"),this.byId("First_name"),this.byId("Last_name"),this.byId("Language_Sign"),this.byId("Sign_Order"),this.byId("Pdf_Sign_Field")];t.forEach(function(e){e.setValueState("None")});var a=e.getSource().getParent();a.close()},cancelEditSigner:function(e){var t=[this.byId("Reg_Reference_Edit"),this.byId("Tech_Id_Edit"),this.byId("Email_address_Edit"),this.byId("Phone_number_Edit"),this.byId("First_name_Edit"),this.byId("Last_name_Edit"),this.byId("Language_Sign_Edit"),this.byId("Sign_Order_Edit"),this.byId("Pdf_Sign_Field_Edit")];t.forEach(function(e){e.setValueState("None")});var a=e.getSource().getParent();a.close()},cancelNewAttr:function(e){var t=e.getSource().getParent();t.close()},cancelEditAttr:function(e){var t=e.getSource().getParent();t.close()},cancelCheckMap:function(e){var t=e.getSource().getParent();t.close()},refreshGlobalVar:function(e){var t=this.getModel("globalVar");var a="/Di_Template";var s=a+"(guid'"+e+"')";var i=this.getOwnerComponent().getModel();i.read(s,{urlParameters:{$expand:"mappings"},success:function(e,a){var s=e;var i=[];for(var r=0;r<s.mappings.results.length;r++){if(s.mappings.results[r].mapping_object=="GLOBAL_VAR"){i.push(s.mappings.results[r])}}t.setData(i);t.refresh()},error:function(e){}})},refreshAttribFilters:function(e){var t=this.getModel("filters"),a=this.getModel("attributes");var s="/Di_Template";var i=s+"(guid'"+e+"')";var r=this.getOwnerComponent().getModel();var n=this;n.oldFilters=[];r.read(i,{urlParameters:{$expand:"attributes/values_attr"},success:function(e,s){var i=e;var r=i.attributes.results;var l=[];var o=[];if(r){for(var d=0;d<r.length;d++){var u={uuid:r[d].uuid,name:r[d].name,description:r[d].description,path:r[d].xpath,sign:r[d].sign};l.push(u);for(var g=0;g<r[d].values_attr.results.length;g++){var p={uuid:r[d].values_attr.results[g].uuid,attr_uuid:r[d].uuid,name:r[d].name,description:r[d].description,path:r[d].xpath,value:r[d].values_attr.results[g].value};o.push(p);var c=Object.assign({},p);n.oldFilters.push(c)}}}t.setData(o);t.refresh();a.setData(l);a.refresh()},error:function(e){}})},initModels:function(e){this.getView().getModel("template").setData();this.getView().getModel("template").refresh();this.getView().getModel("header").setData();this.getView().getModel("header").refresh();this.getView().getModel("doctypes").setData();this.getView().getModel("doctypes").refresh();this.getView().getModel("planning").setData();this.getView().getModel("planning").refresh();this.getView().getModel("filters").setData();this.getView().getModel("filters").refresh();this.getView().getModel("attributes").setData();this.getView().getModel("attributes").refresh()},onAddFilter:function(e){var t=this.getModel("filters");var a=t.getData();var s={uuid:"",attr_uuid:this.selectedAttr,value:""};a.push(s);t.setData(a);t.refresh()},arraysEquals:function(e,t){if(!t)return false;if(e.length!=t.length)return false;for(var a=0,s=e.length;a<s;a++){if(e[a]instanceof Array&&t[a]instanceof Array){if(!e[a].equals(t[a]))return false}else if(e[a].value!==t[a].value){return false}}return true},closeManageAttr:function(e){var t=this.getModel("filters");var a=t.getData();var s=this.arraysEquals(this.oldFilters,a);var i=e.getSource().getParent();var r=this.getModel("header");var n=r.getData().uuid;var l="You will lose unsaved values, do you want to continue?";var o=this.getModel("objectView");var d=this;var u={};if(!s){var g=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:l}),beginButton:new sap.m.Button({text:"Yes",press:function(){d.refreshAttribFilters(n);g.close();i.close()}}),endButton:new sap.m.Button({text:"No",press:function(){g.close()}}),afterClose:function(){g.destroy()}});g.open()}else{d.refreshAttribFilters(n);i.close()}},cancelNewFilter:function(e){var t=e.getSource().getParent();t.close()},editAttr:function(e){var t=e.getSource().getParent().getParent().getBindingContext("attributes").getPath();var a=this.getView().getModel("attributes");var s=this.getModel("editAttr");var i=this.getView().getModel();var n=t+"/uuid";var l=a.getProperty(n);n=t+"/description";var o=a.getProperty(n);n=t+"/name";var d=a.getProperty(n);n=t+"/path";var u=a.getProperty(n);var g={uuid:l,name:d,description:o,path:u};s.setData(g);s.refresh();if(!this.byId("editAttribute")){r.load({id:this.getView().getId(),name:"shapein.TemplatesConfiguration.view.fragments.editAttribute",controller:this}).then(function(e){this.getView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());e.open()}.bind(this))}else{this.byId("editAttribute").open();this.byId("NameAttribuEdit").setValueState("None");this.byId("DescAttribuEdit").setValueState("None");this.byId("PathAttribuEdit").setValueState("None")}},saveEditAttr:function(e){var t=[this.byId("NameAttribuEdit"),this.byId("DescAttribuEdit"),this.byId("PathAttribuEdit")],a=false;t.forEach(function(e){a=this._validateInputNewP(e)||a},this);if(a){sap.m.MessageBox.alert("A validation error has occurred.");return}var s=this;var i=this.getModel("editAttr");var r=i.getData();var n=this.getView().getModel();var l=r.uuid;var o=r.description;var d=r.name;var u=r.path;var g={name:d,description:o,xpath:u};var n=s.getOwnerComponent().getModel();var p="Are you sure to edit this attribute?";var c=this.getModel("header");var h=c.getData().uuid;var f="/Di_Template_Worker_Attr(guid'"+l+"')";var v=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:p}),beginButton:new sap.m.Button({text:"Yes",press:function(){n.update(f,g,{headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(e,t){s.refreshAttribFilters(h);s.byId("editAttribute").close();sap.m.MessageToast.show("Attribute updated!!")},error:function(e){sap.m.MessageToast.show("Error")}});v.close()}}),endButton:new sap.m.Button({text:"No",press:function(){v.close()}}),afterClose:function(){v.destroy()}});v.open()},editFil:function(e){e.getSource().getParent().getParent().getCells()[0].setEnabled(true);var t=e.getSource().getParent().getParent().getBindingContext("filters").getPath();var a=this.getModel("filters");var s=t+"/uuid";var i=a.getProperty(s);s=t+"/name";var r=a.getProperty(s);s=t+"/value";var n=a.getProperty(s);var l={uuid:i,name:r,value:n}},deleteAttr:function(e){var t=this.getModel("header");var a=t.getData().uuid;var s=e.getSource().getParent().getParent().getBindingContext("attributes").getPath();var i=this.getView().getModel("attributes");var r=this.getView().getModel();var n=s+"/uuid";var l=i.getProperty(n);var o="/Di_Template_Worker_Attr(guid'"+l+"')";var d="Are you sure to delete this attribute?";var u=this;var g=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:d}),beginButton:new sap.m.Button({text:"Yes",press:function(){r.remove(o,{success:function(e,t){u.refreshAttribFilters(a);sap.m.MessageToast.show("Attribute deleted succesfully.")},error:function(e){sap.m.MessageToast.show("Error")}});g.close()}}),endButton:new sap.m.Button({text:"No",press:function(){g.close()}}),afterClose:function(){g.destroy()}});g.open()},execCopyTemp:function(e){var t=e.getSource().getParent();var a=this.getModel("header");var s=a.getData().uuid;var i=this.byId("selTemplate").getSelectedKey();var r=this.byId("copMap").getSelected();var n=this.byId("copMeta").getSelected();var l=this.byId("copVar").getSelected();var o=this.byId("copPlan").getSelected();var d=this.byId("copPlanR").getSelected();var u=this.byId("copSign").getSelected();var g=this.byId("copAtt").getSelected();var p=this;var c=this.getModel("objectView");var h=this.getOwnerComponent().getModel();var f="Are you sure to copy these Objects in this Template?\n All existing objects from the template will be deleted and replaced by those from the other template.";var p=this;var v=new sap.m.Dialog({title:"Confirmation",type:"Message",state:"Warning",content:new sap.m.Text({text:f}),beginButton:new sap.m.Button({text:"Yes",press:function(){h.callFunction("/copy_template_config",{method:"GET",urlParameters:{uuid_new:s,uuid_to_copy:i,mappings:r,metadata:n,variables:l,planning:o,planning_rep:d,sign_conf:u,worker_attr:g},success:function(e,a){if(r&&n){p.refreshObjectsTemplate(s,"X","X")}else if(r&&!n){p.refreshObjectsTemplate(s,"X","")}else if(!r&&n){p.refreshObjectsTemplate(s,"","X")}else{p.refreshObjectsTemplate(s,"","")}t.close();c.setProperty("/busy",false);sap.m.MessageToast.show("Objects copied successfully")},error:function(e){t.close();c.setProperty("/busy",false);sap.m.MessageToast.show("Error")}});v.close()}}),endButton:new sap.m.Button({text:"No",press:function(){v.close()}}),afterClose:function(){v.destroy()}});v.open()},deletePlanningRep:function(e){var t=this.getModel("header");var a=t.getData().uuid;var s=this.getModel("planningRep");var i=this;var r=this.getModel("objectView");var n=this.getOwnerComponent().getModel();var l="Are you sure to delete this Reprocessing Planning?";var i=this;var o=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:l}),beginButton:new sap.m.Button({text:"Yes",press:function(){n.callFunction("/delete_planning_repro",{method:"GET",urlParameters:{uuid:a},success:function(e,t){i.exist_plan_Rep="";var a={execute:true,begda:"2020-01-01",endda:"9999-12-31",periodicity_type:"W",ontime:false,periodicity_values:"2-4-6",time_frecuency:"1m",time_start:"00:00:00",time_end:"23:59:00",time_zone:"UTC"};var n={comments:"",enable:"U"};n.plan_d=a;n.adata=[];s.setData(n);s.refresh();r.setProperty("/busy",false);sap.m.MessageToast.show("Reprocessing Planning deleted!")},error:function(e){r.setProperty("/busy",false);sap.m.MessageToast.show("Error")}});o.close()}}),endButton:new sap.m.Button({text:"No",press:function(){o.close()}}),afterClose:function(){o.destroy()}});o.open()},onCopyConfig:function(e){var t=this.getModel("header");var a=t.getData().uuid;if(!this.byId("copyConfigTemp")){r.load({id:this.getView().getId(),name:"shapein.TemplatesConfiguration.view.fragments.copyTemplate",controller:this}).then(function(e){this.getView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());var t=this.byId("selTemplate").getItems();for(var s=0;s<t.length;s++){if(t[s].getKey()==a){t[s].setEnabled(false)}else{t[s].setEnabled(true)}}e.open()}.bind(this))}else{this.byId("copyConfigTemp").open();this.byId("copPlan").setSelected(false);this.byId("copPlanR").setSelected(false);this.byId("copMap").setSelected(false);this.byId("copMeta").setSelected(false);this.byId("copVar").setSelected(false);this.byId("copAtt").setSelected(false);this.byId("copSign").setSelected(false);var s=this.byId("selTemplate").getItems();for(var i=0;i<s.length;i++){if(s[i].getKey()==a){s[i].setEnabled(false)}else{s[i].setEnabled(true)}}}},cancelCopyTemp:function(e){var t=e.getSource().getParent();t.close()},deleteGlobalVar:function(e){var t=this.getModel("header");var a=t.getData().uuid;var s=e.getSource().getParent().getParent().getBindingContext("globalVar").getPath();var i=this.getView().getModel("globalVar");var r=this.getView().getModel();var n=s+"/uuid";var l=i.getProperty(n);var o="/Di_Template_Mappings(guid'"+l+"')";var d="Are you sure to delete this global variable?";var u=this;var g=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:d}),beginButton:new sap.m.Button({text:"Yes",press:function(){r.remove(o,{success:function(e,t){u.refreshGlobalVar(a);sap.m.MessageToast.show("Global Variable deleted succesfully.")},error:function(e){sap.m.MessageToast.show("Error")}});g.close()}}),endButton:new sap.m.Button({text:"No",press:function(){g.close()}}),afterClose:function(){g.destroy()}});g.open()},deleteSigner:function(e){var t=this.getModel("header");var a=t.getData().uuid;var s=e.getSource().getParent().getParent().getBindingContext("signature").getPath();var i=s.split("/");var r=parseInt(i[i.length-1]);var n=this.getView().getModel("signature");var l=n.getData();var o="Are you sure to delete this signer?";var d=this;var u=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:o}),beginButton:new sap.m.Button({text:"Yes",press:function(){l.signers.splice(r,1);n.setData(l);n.refresh();sap.m.MessageToast.show("Signer deleted succesfully.");u.close()}}),endButton:new sap.m.Button({text:"No",press:function(){u.close()}}),afterClose:function(){u.destroy()}});u.open()},configNewTemp:function(e){if(!this.byId("newTemp")){r.load({id:this.getView().getId(),name:"shapein.TemplatesConfiguration.view.fragments.newTemplateConfig",controller:this}).then(function(e){this.getView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());e.open()}.bind(this))}else{this.byId("newTemp").open()}},onSaveValues:function(e){var t="Are you sure you want to save these values?";var a=this.getModel("objectView");var s=this;var i={};var r=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:t}),beginButton:new sap.m.Button({text:"Yes",press:function(){a.setProperty("/busy",true);var e=s.selectedAttr;s.deleteOldValuesCreateValues(e);r.close()}}),endButton:new sap.m.Button({text:"No",press:function(){r.close()}}),afterClose:function(){r.destroy()}});r.open()},saveSettingsSign:function(){var e=this.getModel("signtypes");var t=e.getData();var a=this.getModel("signature");var s=a.getData();var i=s.signers;var r=this.getView().byId("SignType").getSelectedKey();var n=this.getView(),l=[n.byId("SignTitle"),n.byId("SignReason"),n.byId("SignLocation"),n.byId("ExpDate")],o=false;if(n.byId("SignType").getSelectedKey()===""){n.byId("SignType").setValueState("Error");sap.m.MessageBox.alert("A validation error has occurred.");return}else{n.byId("SignType").setValueState("None")}l.forEach(function(e){o=this._validateInputNewP(e)||o},this);if(o){sap.m.MessageBox.alert("A validation error has occurred.");return}if(i.length<1){sap.m.MessageBox.alert("You have not entered any signer.");return}var d=t.find(e=>e.id===r);var u="";for(var g=0;g<i.length;g++){if(i[g].type=="organization"){if(u=="X"){var p="There can only be one signer of type 'organization'.";sap.m.MessageBox.alert(p);return}u="X"}if(d){if(d.backend_code=="docusign_protect_and_sign"){if(!i[g].generate_pdf_sign_field){var p="Signer with 'Sign Field' "+i[g].pdf_sign_field+" does not have the coordinates informed. Please edit it.";sap.m.MessageBox.alert(p);return}if(i[g].role_name){delete i[g].role_name}}else if(d.backend_code=="docusign"){if(!i[g].role_name){}if(i[g].generate_pdf_sign_field){delete i[g].generate_pdf_sign_field}}}}if(d){if(d.delegation&&u==""){var p="An 'organization' type signatory must be present in the signers.";sap.m.MessageBox.alert(p);return}}var c=this.getModel("signature");var h=c.getData().uuid;var f="Are you sure you want to save these signature settings?";var v=this.getModel("objectView");var b=this;var m={};var y=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:f}),beginButton:new sap.m.Button({text:"Yes",press:function(){v.setProperty("/busy",true);if(h&&h!=""){b.deleteOldConfSignature(h)}else{b.createNewConfSignature()}y.close()}}),endButton:new sap.m.Button({text:"No",press:function(){y.close()}}),afterClose:function(){y.destroy()}});y.open()},deleteOldConfSignature:function(e){var t=this;var a=this.getModel("objectView");var s=this.getOwnerComponent().getModel();s.callFunction("/delete_conf_signature",{method:"GET",urlParameters:{uuid:e},success:function(e,a){t.createNewConfSignature()},error:function(e){a.setProperty("/busy",false)}})},createNewConfSignature:function(){var e=this.getModel("signature");var t=e.getData();var a=t.signers;var s=this.getModel("objectView");var i=this.getView(),r=[i.byId("SignType"),i.byId("SignTitle"),i.byId("SignReason"),i.byId("SignLocation"),i.byId("ExpDate"),i.byId("SignMessage")];var n=this.getModel("header");var l=n.getData().uuid;var o=this.getOwnerComponent().getModel();var d={signature_type:r[0].getSelectedKey(),title:r[1].getValue(),reason:r[2].getValue(),location:r[3].getValue(),expiration_date:r[4].getValue(),message:r[5].getValue(),signers:a};var u=JSON.stringify(d);s.setProperty("/busy",false);var g={template_uuid:l,api_version:"v1",json_cfg:u};o.create("/Di_Template_Sign_Cfg",g,{headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(t,a){var s=t;var i=JSON.parse(s.json_cfg);i.uuid=s.uuid;e.setData(i);e.refresh();sap.m.MessageToast.show("Signature Configuration saved succesfully.")},error:function(e){sap.m.MessageToast.show("Error")}})},selectSMS:function(e){var t=this.byId("checkSMSnot").getSelected();var a=this.byId("checkSMSau").getSelected();if(t||a){this.byId("Phone_number").setRequired(true)}else{this.byId("Phone_number").setRequired(false)}},selectSMS_Edit:function(e){var t=this.byId("checkSMSnot_Edit").getSelected();var a=this.byId("checkSMSau_Edit").getSelected();if(t||a){this.byId("Phone_number_Edit").setRequired(true)}else{this.byId("Phone_number_Edit").setRequired(false)}},deleteOldValuesCreateValues:function(e){var t=this;var a=this.getModel("objectView");var s=this.getOwnerComponent().getModel();var e=String(e);s.callFunction("/delete_attr_values",{method:"GET",urlParameters:{uuid:e},success:function(a,s){t.createBatchAttrValues(e)},error:function(e){a.setProperty("/busy",false)}})},deleteFil:function(e){var t=this.getModel("header");var a=t.getData().uuid;var s=e.getSource().getParent().getParent().getBindingContext("filters").getPath();var i=this.getView().getModel("filters");var r=i.getData();var n=parseInt(s.substr(1));var l=this.getView().getModel();var o=s+"/uuid";var d=i.getProperty(o);var u="/Di_Template_Worker_Attr_Values(guid'"+d+"')";var g="Are you sure to delete this value?";var p=this;var c=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:g}),beginButton:new sap.m.Button({text:"Yes",press:function(){if(d==""){r.splice(n,1);i.setData(r);i.refresh()}else{l.remove(u,{success:function(e,t){p.refreshAttribFilters(a);sap.m.MessageToast.show("Value deleted succesfully.")},error:function(e){sap.m.MessageToast.show("Error")}})}c.close()}}),endButton:new sap.m.Button({text:"No",press:function(){c.close()}}),afterClose:function(){c.destroy()}});c.open()},createBatchAttrValues:function(e){var t=this.getOwnerComponent().getModel();var a=this.getModel("filters");var s=a.getData();var i="/Di_Template_Worker_Attr_Values";t.setDeferredGroups(["createGroupVal"]);var r=this;for(var n=0;n<s.length;n++){if(s[n].attr_uuid!==e){continue}var l={};l.attr_uuid=e;l.value=s[n].value;t.create(i,l,{groupId:"createGroupVal"})}t.submitChanges({groupId:"createGroupVal",success:r.successCreateBatchVal.bind(r),error:r.errorCreateBatchVal.bind(r)})},successCreateBatchVal:function(e,t){sap.m.MessageToast.show("Values updated succesfully.");var a=this.getModel("objectView");var s=this.getModel("header");var i=s.getData().uuid;this.refreshAttribFilters(i);a.setProperty("/busy",false)},errorCreateBatchVal:function(e){var t=this.getModel("objectView");t.setProperty("/busy",false);sap.m.MessageToast.show("Error")},onSaveMap:function(e){var t="Are you sure you want to save these mappings?";var a=this.getModel("objectView");var s=this;var i={};var r=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:t}),beginButton:new sap.m.Button({text:"Yes",press:function(){a.setProperty("/busy",true);var e=s.byId("template_uuid").getText();s.deleteOldMappingsCreateMappings(e,"");r.close()}}),endButton:new sap.m.Button({text:"No",press:function(){r.close()}}),afterClose:function(){r.destroy()}});r.open()},onSaveMeta:function(e){var t="Are you sure you want to save these metadata mappings?";var a=this.getModel("objectView");var s=this;var i={};var r=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:t}),beginButton:new sap.m.Button({text:"Yes",press:function(){a.setProperty("/busy",true);var e=s.byId("template_uuid").getText();s.deleteOldMappingsCreateMappingsMeta(e,"");r.close()}}),endButton:new sap.m.Button({text:"No",press:function(){r.close()}}),afterClose:function(){r.destroy()}});r.open()},deleteOldMappingsCreateMappings:function(e,t){var a=this;var s=this.getModel("objectView");var i=this.getOwnerComponent().getModel();var r=String(e);i.callFunction("/delete_mappings",{method:"GET",urlParameters:{uuid:r},success:function(s,i){a.createBatchMappings(e,t)},error:function(e){if(t==""){s.setProperty("/busy",false)}}})},deleteOldMappingsCreateMappingsMeta:function(e,t){var a=this;var s=this.getModel("objectView");var i=this.getOwnerComponent().getModel();var r=String(e);i.callFunction("/delete_mappings_meta",{method:"GET",urlParameters:{uuid:r},success:function(s,i){a.createBatchMappingsMeta(e,t)},error:function(e){if(t==""){s.setProperty("/busy",false)}}})},createBatchMappings:function(e,t){var a=this.getOwnerComponent().getModel();var s=this.getModel("template");var i=s.getData().variables;var r="/Di_Template_Mappings";a.setDeferredGroups(["createGroup"]);var n=this;for(var l=0;l<i.length;l++){var o={};o.template_uuid=e;o.variable=i[l].slug;if(i[l].path==null){i[l].path=""}o.mapping=i[l].path;o.mapping_object="TEMPL_MAPP";o.mapping_type="XPATH";o.source=i[l].source;o.required=i[l].required;o.vartype=i[l].type_id;a.create(r,o,{groupId:"createGroup"})}if(t=="X"){a.submitChanges({groupId:"createGroup",success:n.successUpdateBatchMCopy.bind(n),error:n.errorUpdateBatchCopy})}else{a.submitChanges({groupId:"createGroup",success:n.successUpdateBatchM.bind(n),error:n.errorUpdateBatch})}},createBatchMappingsMeta:function(e,t){var a=this.getOwnerComponent().getModel();var s=this.getModel("template");var i=s.getData().metadata;var r="/Di_Template_Mappings";a.setDeferredGroups(["createGroup"]);var n=this;for(var l=0;l<i.length;l++){var o={};o.template_uuid=e;o.variable=i[l].code;if(i[l].path==null){i[l].path=""}o.mapping=i[l].path;o.mapping_object="DOCID_META";o.mapping_type="XPATH";o.required=i[l].required;o.source=i[l].source;o.vartype=i[l].type_id;a.create(r,o,{groupId:"createGroup"})}if(t=="X"){a.submitChanges({groupId:"createGroup",success:n.successUpdateBatchMCopyMeta.bind(n),error:n.errorUpdateBatchCopyMeta})}else{a.submitChanges({groupId:"createGroup",success:n.successUpdateBatchMMeta.bind(n),error:n.errorUpdateBatchMeta})}},successUpdateBatchMCopy:function(e,t){},errorUpdateBatchCopy:function(e){sap.m.MessageToast.show("Error")},successUpdateBatchM:function(e,t){sap.m.MessageToast.show("Mappings updated succesfully.");var a=this.getModel("objectView");a.setProperty("/busy",false)},errorUpdateBatch:function(e){var t=this.getModel("objectView");t.setProperty("/busy",false);sap.m.MessageToast.show("Error")},successUpdateBatchMCopyMeta:function(e,t){},errorUpdateBatchCopyMeta:function(e){sap.m.MessageToast.show("Error")},successUpdateBatchMMeta:function(e,t){sap.m.MessageToast.show("Metadata Mappings updated succesfully.");var a=this.getModel("objectView");a.setProperty("/busy",false)},errorUpdateBatchMeta:function(e){var t=this.getModel("objectView");t.setProperty("/busy",false);sap.m.MessageToast.show("Error")},execNewSigner:function(e){var t=this.getModel("signature");var a=t.getData();var s=this.getModel("signtypes");var i=s.getData();var r=this.getModel("signer");var n=r.getData();var l=[this.byId("Reg_Reference"),this.byId("Tech_Id"),this.byId("Email_address"),this.byId("Phone_number"),this.byId("First_name"),this.byId("Last_name"),this.byId("Language_Sign"),this.byId("Sign_Order"),this.byId("Pdf_Sign_Field")];var o=[];var d=false;for(var u=0;u<l.length;u++){if(l[u].getRequired()){o.push(l[u])}else{l[u].setValueState("None")}}o.forEach(function(e){d=this._validateInputNewP(e)||d},this);if(d){sap.m.MessageBox.alert("A validation error has occurred.");return}var g=this.byId("SignType").getSelectedKey();var p=i.find(e=>e.id===g);if(p){if(p.backend_code=="docusign_protect_and_sign"){var c=this.byId("llx").getValue();if(c==""){sap.m.MessageBox.alert("You must select the coordinates of the sign field.");return}}}var h=[];var f={};for(var u=0;u<l.length;u++){if(l[u].getVisible()){if(u!=6){if(l[u].getValue()!=""){var v=l[u].getBinding("value").getPath();v=v.substring(1);f[v]=l[u].getValue()}}else{var v=l[u].getBinding("selectedKey").getPath();v=v.substring(1);f[v]=l[u].getSelectedKey()}}}var b={};b.page=this.byId("sfpage").getValue();b.llx=this.byId("llx").getValue();b.lly=this.byId("lly").getValue();b.urx=this.byId("upx").getValue();b.ury=this.byId("upy").getValue();f.generate_pdf_sign_field=Object.assign({},b);var m=this.byId("Signature_Type").getSelectedKey();f.type=m;var y=this.byId("checkSMSnot").getSelected();f.with_sms_notification=y;var _=this.byId("checkSMSau").getSelected();f.with_sms_authentication=_;var I=this.byId("checkSMSsend").getSelected();f.send_signed_document=I;a.signers.push(f);t.setData(a);t.refresh();var V=e.getSource().getParent();V.close()},execEditSigner:function(e){var t=this.editIndex;var a=this.getModel("signature");var s=a.getData();var i=this.getModel("signer");var r=i.getData();var n=this.getModel("signtypes");var l=n.getData();var o=[this.byId("Reg_Reference_Edit"),this.byId("Tech_Id_Edit"),this.byId("Email_address_Edit"),this.byId("Phone_number_Edit"),this.byId("First_name_Edit"),this.byId("Last_name_Edit"),this.byId("Language_Sign_Edit"),this.byId("Sign_Order_Edit"),this.byId("Pdf_Sign_Field_Edit")];var d=[];var u=false;for(var g=0;g<o.length;g++){if(o[g].getRequired()){d.push(o[g])}}d.forEach(function(e){u=this._validateInputNewP(e)||u},this);if(u){sap.m.MessageBox.alert("A validation error has occurred.");return}var p=this.byId("SignType").getSelectedKey();var c=l.find(e=>e.id===p);if(c){if(c.backend_code=="docusign_protect_and_sign"){var h=this.byId("llx_Edit").getValue();if(h==""){sap.m.MessageBox.alert("You must select the coordinates of the sign field.");return}}}var f=[];var v={};for(var g=0;g<o.length;g++){if(o[g].getVisible()){if(g!=6){if(o[g].getValue()!=""){var b=o[g].getBinding("value").getPath();b=b.substring(1);v[b]=o[g].getValue()}}else{var b=o[g].getBinding("selectedKey").getPath();b=b.substring(1);v[b]=o[g].getSelectedKey()}}}var m={};m.page=this.byId("sfpage_Edit").getValue();m.llx=this.byId("llx_Edit").getValue();m.lly=this.byId("lly_Edit").getValue();m.urx=this.byId("upx_Edit").getValue();m.ury=this.byId("upy_Edit").getValue();v.generate_pdf_sign_field=Object.assign({},m);var y=this.byId("Signature_Type_Edit").getSelectedKey();v.type=y;var _=this.byId("checkSMSnot_Edit").getSelected();v.with_sms_notification=_;var I=this.byId("checkSMSau_Edit").getSelected();v.with_sms_authentication=I;var V=this.byId("checkSMSsend_Edit").getSelected();v.send_signed_document=V;s.signers[t]=Object.assign({},v);a.setData(s);a.refresh();var M=e.getSource().getParent();M.close()},changeExpDate:function(e){var t=parseInt(e.getParameter("value"));if((t>365||t<1)&&t!=""){e.getSource().setValue(this.oldExpDate)}else{this.oldExpDate=t}},execNewTemp:function(e){var t=this.getModel("filters"),a=this.getModel("attributes"),s=this.getModel("planning"),i=this.getModel("planningRep"),r=this.getModel("globalVar"),n=this.getModel("signature");var l=this.getView(),o=[l.byId("DocTitle")],d=false;o.forEach(function(e){d=this._validateInputNewP(e)||d},this);if(d){sap.m.MessageBox.alert("A validation error has occurred.");return}var u=l.byId("BusinessProcess").getSelectedKey();if(u==""){sap.m.MessageBox.alert("Business Process Type is required.");return}var g=false;var p=l.byId("SegButSig").getSelectedKey();var c=false;if(p=="A"){c=true}var h=l.byId("DocTitle").getValue();var f=l.byId("Doc_Types").getSelectedKey();if(f==""){sap.m.MessageBox.alert("Document Type is required.");return}var v="Are you sure you want to save this Template Configuration?";var b=this;var m={};var y=e.getSource().getParent();var _=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:v}),beginButton:new sap.m.Button({text:"Yes",press:function(){var e={template_id:b.template_id,template_version:String(b.template_version),bpt_id:u,format:b.format,updated_at:b.updated_at,deprecated:false,description:b.description,doc_type_id:f,doc_title:h,active:g,signature:c,language:b.template_language};var l=b.getOwnerComponent().getModel();y.setBusy(true);l.create("/Di_Template",e,{headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(e,l){var o=e;y.setBusy(false);y.close();m.uuid=o.uuid;m.id=o.template_id;var d={};d.id=m.id;d.active_version=o.template_version;o.mappings=[];o.metadata=[];o.sign_cfg=null;m.version=o.template_version;m.description=b.description;m.active=o.active;m.deprecated=o.deprecated;if(m.active){b.oldKey="A"}else{b.oldKey="I"}m.doc_type=o.doc_type_id;m.title=o.doc_title;m.signature=o.signature;m.language=o.language;var u=b.getOwnerComponent().getModel("BProcess").getData();var g=u.find(e=>e.bpt_id===o.bpt_id);m.business_process_text=g.name;var p=b.getOwnerComponent().getModel("doctypes").getData();var c=p.find(e=>e.id===o.doc_type_id);m.doc_type_text=c.label;m.business_process=o.bpt_id;b.oldBP=m.business_process;b.oldTitle=m.title;b.oldDType=m.doc_type;var h=b.getModel("header");h.setData(m);h.refresh();var f=[];var v=[];var _={};_.uuid="";_.signers=[];b.exist_plan="";b.exist_plan_Rep="";var I={execute:true,begda:"2020-01-01",endda:"9999-12-31",periodicity_type:"W",ontime:false,periodicity_values:"2-4-6",time_frecuency:"1m",time_start:"00:00:00",time_end:"23:59:00",time_zone:"UTC"};var V={comments:""};V.plan_d=I;V.adata=[];n.setData(_);var M=[];r.setData(M);r.refresh();n.refresh();t.setData(v);t.refresh();a.setData(f);a.refresh();s.setData(V);s.refresh();i.setData(V);i.refresh();b.call_Template_details(o,d);b.createPagesBatch(m.uuid);sap.m.MessageToast.show("Template Configuration created succesfully.")},error:function(e){y.setBusy(false);sap.m.MessageToast.show("Error")}});_.close()}}),endButton:new sap.m.Button({text:"No",press:function(){_.close()}}),afterClose:function(){_.destroy()}});_.open()},cancelNewTemp:function(e){var t=n.getInstance();var a=t.getPreviousHash();if(a!==undefined){window.history.go(-1)}else{var s=sap.ui.core.UIComponent.getRouterFor(this);s.navTo("overview",true)}var i=e.getSource().getParent();i.close()},onEdit:function(){this.showCustomActions(true);this.byId("segButton").setEnabled(true);this.byId("titleDisplay").setVisible(false);this.byId("titleChange").setVisible(true);this.byId("DTdisplay").setVisible(false);this.byId("labelDT").setVisible(true);this.byId("DocTypesH").setVisible(true);this.oSemanticPage.setHeaderExpanded(true);this.oEditAction.setVisible(false)},onSaveBP:function(){var e=this.getModel("header");var t=e.getData();var a=t.uuid;var s=this;var i="/Di_Template";var r=i+"(guid'"+a+"')";var n=this.getOwnerComponent().getModel();var l=this.byId("BusinessProcessH").getSelectedKey();var o={bpt_id:l};n.update(r,o,{headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(a,i){var r=s.getOwnerComponent().getModel("BProcess").getData();var n=r.find(e=>e.bpt_id===a.bpt_id);t.business_process_text=n.name;e.setData(t);e.refresh();sap.m.MessageBox.alert("Business Process successfully saved!")},error:function(e){sap.m.MessageToast.show("Error")}})},onSaveConfTemplate:function(){var e=this.getModel("header");var t=this.getModel("template");var a=t.getData().metadata;var s=e.getData();var i=s.uuid;var r=this;var n="/Di_Template";var l=n+"(guid'"+i+"')";var o=this.getOwnerComponent().getModel();var d=false;if(this.byId("segButton2").getSelectedKey()=="A"){d=true}var u=false;if(this.byId("segButton3").getSelectedKey()=="A"){u=true}var g=this.byId("DocTypesH").getSelectedKey();var p=this.byId("titleChange").getValue();var c={doc_type_id:g,doc_title:p,active:d,signature:u};var h=false;for(var f=0;f<a.length;f++){if(a[f].path!=""){h=true;break}}if(g!==r.oldDocType&&h){var v="If you change the document type, the associated metadata mappings will be deleted. Do you want to continue?";var b=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:v}),beginButton:new sap.m.Button({text:"Yes",press:function(){r.saveConfTempConf(c,d,i,u,"X");b.close()}}),endButton:new sap.m.Button({text:"No",press:function(){b.close()}}),afterClose:function(){b.destroy()}});b.open()}else{if(g!==r.oldDocType){r.saveConfTempConf(c,d,i,u,"X")}else{r.saveConfTempConf(c,d,i,u,"")}}},saveConfTempConf:function(e,t,a,s,i){var r=this.getOwnerComponent().getModel();var n=this;if(t){r.callFunction("/can_be_activated",{method:"GET",urlParameters:{uuid:a,sign:s},success:function(t,a){var s=t.value;if(s==""){n.saveConfigTemplate(e,i)}else{var r="This template cannot be activated. \n "+s;sap.m.MessageBox.error(r)}},error:function(e){sap.m.MessageToast.show("Error")}})}else{this.saveConfigTemplate(e,i)}},onSelectIconTabHeader:function(e){var t=e.getParameter("key");if(t=="GlobalVariables"){this.byId("tableGlobalVar").setVisible(true);this.byId("tableMetadata").setVisible(false)}else if(t=="Metadata"){this.byId("tableGlobalVar").setVisible(false);this.byId("tableMetadata").setVisible(true)}},saveConfigTemplate:function(e,t){var a=this.getModel("header"),s=this.getModel("signature");var i=a.getData();var r=i.uuid;var n=this;var l="/Di_Template";var o=l+"(guid'"+r+"')";var d=this.getOwnerComponent().getModel();var u=this.getModel("signature");var g=u.getData().uuid;if(!e.signature&&g&&g!=""){var p="Saving the template settings will clear the signature settings. Do you want to continue?";var n=this;var c={};var h=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:p}),beginButton:new sap.m.Button({text:"Yes",press:function(){d.update(o,e,{headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(e,l){i.active=e.active;i.signature=e.signature;var o=n.getOwnerComponent().getModel("doctypes").getData();var d=o.find(t=>t.id===e.doc_type_id);i.doc_type_text=d.label;i.doc_type=e.doc_type_id;n.oldDocType=e.doc_type_id;a.setData(i);a.refresh();var u={};u.uuid="";u.signers=[];s.setData(u);s.refresh();h.close();sap.m.MessageBox.alert("Configuration successfully saved!");if(t=="X"){n.byId("tablemeta").setBusy(true);n.refreshObjectsTemplate(r,"")}},error:function(e){h.close();sap.m.MessageToast.show("Error")}})}}),endButton:new sap.m.Button({text:"No",press:function(){h.close()}}),afterClose:function(){h.destroy()}});h.open()}else{d.update(o,e,{headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(e,s){i.active=e.active;i.signature=e.signature;var l=n.getOwnerComponent().getModel("doctypes").getData();var o=l.find(t=>t.id===e.doc_type_id);i.doc_type_text=o.label;i.doc_type=e.doc_type_id;n.oldDocType=e.doc_type_id;a.setData(i);a.refresh();sap.m.MessageBox.alert("Configuration successfully saved!");if(t=="X"){n.byId("tablemeta").setBusy(true);n.refreshObjectsTemplate(r,"")}},error:function(e){sap.m.MessageToast.show("Error")}})}},onUpdatePlanTemplate:function(e,t,a){var s=this.getModel("header");var i=s.getData();var r=i.uuid;var n=this;var l="/Di_Template";var o=l+"(guid'"+r+"')";var d=this.getOwnerComponent().getModel();if(a=="X"){var u={planning_rep_uuid:e}}else{var u={planning_uuid:e}}d.update(o,u,{headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(s,i){if(a=="X"){var r=n.getModel("planningRep");var l=r.setProperty("/uuid",s.planning_uuid);r.refresh();n.exist_plan_Rep="X";n.createDataBatch(e,t,"X")}else{var r=n.getModel("planning");var l=r.setProperty("/uuid",s.planning_uuid);r.refresh();n.exist_plan="X";n.createDataBatch(e,t,"")}},error:function(e){sap.m.MessageToast.show("Error")}})},onCancel:function(){this.showCustomActions(false);this.byId("segButton").setSelectedKey(this.oldKey);this.byId("titleChange").setValue(this.oldTitle);this.byId("DocTypesH").setSelectedKey(this.oldDType);this.byId("segButton").setEnabled(false);this.byId("BusinessProcessH").setVisible(false);this.byId("titleDisplay").setVisible(true);this.byId("titleChange").setVisible(false);this.byId("DTdisplay").setVisible(true);this.byId("labelDT").setVisible(false);this.byId("DocTypesH").setVisible(false);this.oEditAction.setVisible(true)},showCustomActions:function(e){},onSearch:function(e){var t=e.getParameter("query");var a=e.getSource().getId();if(a.match("searchField2")){this.byId("searchField").setValue(t);var s=this.getView().byId("tablemap2")}else{this.byId("searchField2").setValue(t);var s=this.getView().byId("tablemap")}t=t.toLowerCase();var s=this.getView().byId("tablemap");var i=s.getBinding("items");var r=this.getView().byId("tablemap2");var n=r.getBinding("items");var l=this.byId("Mapped").getSelected();if(l){var o=new sap.ui.model.Filter("slug",sap.ui.model.FilterOperator.Contains,t);var d=new sap.ui.model.Filter("map",sap.ui.model.FilterOperator.EQ,"");i.filter([o,d]);n.filter([o,d])}else{var o=new sap.ui.model.Filter("slug",sap.ui.model.FilterOperator.Contains,t);i.filter([o]);n.filter([o])}},onSearchMeta:function(e){var t=e.getParameter("query");var a=e.getSource().getId();this.byId("searchField2").setValue(t);var s=this.getView().byId("tablemeta");t=t.toLowerCase();var s=this.getView().byId("tablemeta");var i=s.getBinding("items");var r=this.byId("MappedMeta").getSelected();if(r){var n=new sap.ui.model.Filter("code",sap.ui.model.FilterOperator.Contains,t);var l=new sap.ui.model.Filter("map",sap.ui.model.FilterOperator.EQ,"");i.filter([n,l])}else{var n=new sap.ui.model.Filter("code",sap.ui.model.FilterOperator.Contains,t);i.filter([n])}},onSearchGlobalVar:function(e){var t=e.getParameter("query");var a=e.getSource().getId();var s=this.getView().byId("tableGlobalVar");t=t.toLowerCase();var i=s.getBinding("items");var r=new sap.ui.model.Filter("variable",sap.ui.model.FilterOperator.Contains,t);i.filter([r])},noMapped:function(e){var t=e.getSource().getId();var a=e.getParameter("selected");var s=e.getSource().getPartiallySelected();if(a&&this.partiallySel){e.getSource().setSelected(false);this.partiallySel=false}else if(!a&&!this.partiallySel){e.getSource().setSelected(true);e.getSource().setPartiallySelected(true);this.partiallySel=true}if(t.match("Mapped2")){var i=this.byId("Mapped2").getSelected();var r=this.byId("Mapped2").getPartiallySelected();this.byId("Mapped").setSelected(i);this.byId("Mapped").setPartiallySelected(r)}else{var i=this.byId("Mapped").getSelected();var r=this.byId("Mapped").getPartiallySelected();this.byId("Mapped2").setSelected(i);this.byId("Mapped2").setPartiallySelected(r)}var n=this.byId("searchField").getValue();n=n.toLowerCase();var l=this.getView().byId("tablemap").getBinding("items");var o=this.getView().byId("tablemap2").getBinding("items");if(i&&r){var d=new sap.ui.model.Filter("slug",sap.ui.model.FilterOperator.Contains,n);var u=new sap.ui.model.Filter("map",sap.ui.model.FilterOperator.EQ,"");l.filter([d,u]);o.filter([d,u])}else if(i&&!r){var d=new sap.ui.model.Filter("slug",sap.ui.model.FilterOperator.Contains,n);var u=new sap.ui.model.Filter("map",sap.ui.model.FilterOperator.NE,"");l.filter([d,u]);o.filter([d,u])}else{var d=new sap.ui.model.Filter("slug",sap.ui.model.FilterOperator.Contains,n);l.filter([d]);o.filter([d])}},noMappedMeta:function(e){var t=e.getSource().getId();var a=e.getParameter("selected");var s=e.getSource().getPartiallySelected();if(a&&this.partiallySelMeta){e.getSource().setSelected(false);this.partiallySelMeta=false}else if(!a&&!this.partiallySelMeta){e.getSource().setSelected(true);e.getSource().setPartiallySelected(true);this.partiallySelMeta=true}var i=this.byId("MappedMeta").getSelected();var r=this.byId("MappedMeta").getPartiallySelected();var n=this.byId("searchFieldMeta").getValue();n=n.toLowerCase();var l=this.getView().byId("tablemeta").getBinding("items");if(i&&r){var o=new sap.ui.model.Filter("code",sap.ui.model.FilterOperator.Contains,n);var d=new sap.ui.model.Filter("map",sap.ui.model.FilterOperator.EQ,"");l.filter([o,d])}else if(i&&!r){var o=new sap.ui.model.Filter("code",sap.ui.model.FilterOperator.Contains,n);var d=new sap.ui.model.Filter("map",sap.ui.model.FilterOperator.NE,"");l.filter([o,d])}else{var o=new sap.ui.model.Filter("code",sap.ui.model.FilterOperator.Contains,n);l.filter([o])}},applySearchPattern:function(e,t){if(t==""){return true}if(e.getCells()[0].getText()&&e.getCells()[0].getText().toLowerCase().indexOf(t)!=-1){return true}return false},_onBindingChange:function(){var e=this.getView(),t=this.getModel("objectView"),a=e.getElementBinding();if(!a.getBoundContext()){this.getRouter().getTargets().display("objectNotFound");return}var s=this.getResourceBundle(),i=e.getBindingContext().getObject(),r=i.code,n=i.text;t.setProperty("/busy",false);this.addHistoryEntry({title:this.getResourceBundle().getText("objectTitle")+" - "+n,icon:"sap-icon://enter-more",intent:"#Worker-TemplateConfig&/Countries/"+r})},changePeriodType:function(e){var t=e.getParameter("selectedItem");var a=this.getView().byId("days").getItems();if(t.getKey()=="D"){this.byId("MC1").setValueState("None");a.forEach(function(e){e.setValueState("None")})}else if(t.getKey()=="W"){this.byId("MC1").setValueState("None")}else if(t.getKey()=="M"){a.forEach(function(e){e.setValueState("None")})}},changePeriodTypeRep:function(e){var t=e.getParameter("selectedItem");var a=this.getView().byId("daysRep").getItems();if(t.getKey()=="D"){this.byId("MC1Rep").setValueState("None");a.forEach(function(e){e.setValueState("None")})}else if(t.getKey()=="W"){this.byId("MC1Rep").setValueState("None")}else if(t.getKey()=="M"){a.forEach(function(e){e.setValueState("None")})}},selExecute:function(e){var t=e.getParameter("selectedIndex");var a=this.getModel("planning");var s=a.getProperty("/plan_d");if(t==0){s.execute=true}else{s.execute=false}},changeBegda:function(e){var t=e.getParameter("value");var a=e.getSource();var s="None";if(t==""){s="Error"}a.setValueState(s);var i=this.getModel("planning");var r=i.getProperty("/plan_d");r.begda=t},changeEndda:function(e){var t=e.getParameter("value");var a=e.getSource();var s="None";if(t==""){s="Error"}a.setValueState(s);var i=this.getModel("planning");var r=i.getProperty("/plan_d");r.endda=t},changeBegdaRep:function(e){var t=e.getParameter("value");var a=e.getSource();var s="None";if(t==""){s="Error"}a.setValueState(s);var i=this.getModel("planningRep");var r=i.getProperty("/plan_d");r.begda=t},changeEnddaRep:function(e){var t=e.getParameter("value");var a=e.getSource();var s="None";if(t==""){s="Error"}a.setValueState(s);var i=this.getModel("planningRep");var r=i.getProperty("/plan_d");r.endda=t},handleSelectionChange:function(e){var t=e.getSource();var a="None";var s=t.getSelectedKeys();if(s.length>0){t.setValueState(a)}},onChangeView:function(e){var t=this.byId("ScrollCont").getVisible();var a=this.byId("DynamicSideContent").getVisible();if(t){this.byId("ScrollCont").setVisible(false)}else{this.byId("ScrollCont").setVisible(true)}if(a){this.byId("DynamicSideContent").setVisible(false)}else{this.byId("DynamicSideContent").setVisible(true)}},timeChange:function(e){var t=e.getParameter("value");var a=e.getSource();var s="None";if(t==""){s="Error"}a.setValueState(s)},selectCheck:function(e){var t=e.getSource();var a=t.getText();var s=this.getModel("planning");var i=s.getProperty("/plan_d");var r=i.periodicity_values;var n=r.split("-");var l=e.getParameter("selected");if(l){n.push(t.getName())}else{var o=n.indexOf(t.getName());if(o!==-1){n.splice(o,1)}}n.sort();var d=n.join("-");i.periodicity_values=d;var u=this.byId("days").getItems();var g=false;u.forEach(function(e){if(e.getSelected()){g=true}});if(g){u.forEach(function(e){e.setValueState("None")})}},selectCheckRep:function(e){var t=e.getSource();var a=t.getText();var s=this.getModel("planningRep");var i=s.getProperty("/plan_d");var r=i.periodicity_values;var n=r.split("-");var l=e.getParameter("selected");if(l){n.push(t.getName())}else{var o=n.indexOf(t.getName());if(o!==-1){n.splice(o,1)}}n.sort();var d=n.join("-");i.periodicity_values=d;var u=this.byId("daysRep").getItems();var g=false;u.forEach(function(e){if(e.getSelected()){g=true}});if(g){u.forEach(function(e){e.setValueState("None")})}},handleSelectionFinish:function(e){var t=e.getParameter("selectedItems");var a=[];for(var s=0;s<t.length;s++){a.push(t[s].getKey())}a.sort();var i=a.join("-");var r=this.getModel("planning");var n=r.getProperty("/plan_d");n.periodicity_valuesM=i},handleSelectionFinishRep:function(e){var t=e.getParameter("selectedItems");var a=[];for(var s=0;s<t.length;s++){a.push(t[s].getKey())}a.sort();var i=a.join("-");var r=this.getModel("planningRep");var n=r.getProperty("/plan_d");n.periodicity_valuesM=i},convertTZ:function(e,t){return new Date((typeof e==="string"?new Date(e):e).toLocaleString("en-US",{timeZone:t}))},savePlanning:function(e){var t=this.getModel("planning");var a=this.getModel("objectView");var s=this.getView(),i=[s.byId("Comments"),s.byId("DTP1"),s.byId("DTP2"),s.byId("DTP3"),s.byId("begda"),s.byId("endda"),s.byId("TP1"),s.byId("TP2")],r=false;i.forEach(function(e){r=this._validateInputNewP(e)||r},this);if(r){sap.m.MessageBox.alert("A validation error has occurred.")}else{if(this.byId("periodType").getSelectedItem().getKey()=="M"){var n=this.byId("MC1").getSelectedKeys();if(n.length==0){this.byId("MC1").setValueState("Error");sap.m.MessageBox.alert("A validation error has occurred.");return}else{this.byId("MC1").setValueState("None")}}else if(this.byId("periodType").getSelectedItem().getKey()=="W"){var l=this.byId("days").getItems();var o=false;l.forEach(function(e){if(e.getSelected()){o=true}});if(!o){l.forEach(function(e){e.setValueState("Error")});sap.m.MessageBox.alert("A validation error has occurred.");return}}var d=s.byId("TimeZone").getSelectedKey();var u=new Date;var g=this.convertTZ(u,d);var p=i[1].getDateValue();if(p>=g){i[1].setValueState("Error");sap.m.MessageBox.alert("The selected date must be less than the current date in the selected timezone.");return}else{i[1].setValueState("None")}var c=i[2].getDateValue();if(c>=g){i[2].setValueState("Error");sap.m.MessageBox.alert("The selected date must be less than the current date in the selected timezone.");return}else{i[2].setValueState("None")}var h=i[3].getDateValue();if(h>=g){i[3].setValueState("Error");sap.m.MessageBox.alert("The selected date must be less than the current date in the selected timezone.");return}else{i[3].setValueState("None")}var f=i[0].getValue();var v="Are you sure you want to save the Job Planning?";var b=this;var m=e.getSource().getParent();var y=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:v}),beginButton:new sap.m.Button({text:"Yes",press:function(){var e=b.byId("SegBut").getSelectedKey();var s=false;if(e=="A"){s=true}var i={pck_code:"DI_TEMPLG",type:"D",enable:s,processing_type:"I",comments:f};var r=b.getOwnerComponent().getModel();a.setProperty("/busy",true);if(b.exist_plan!=="X"){r.create("/Integration_Pck_Planning",i,{headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(e,t){b.onUpdatePlanTemplate(e.uuid,e.processing_type,"")},error:function(e){a.setProperty("/busy",false);sap.m.MessageToast.show("Error")}})}else{var n=t.getProperty("/uuid");var l="/Integration_Pck_Planning(guid'"+n+"')";r.update(l,i,{headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(e,t){b.updateDataBatch(e.uuid,e.processing_type,"")},error:function(e){a.setProperty("/busy",false);sap.m.MessageToast.show("Error")}})}y.close()}}),endButton:new sap.m.Button({text:"No",press:function(){y.close()}}),afterClose:function(){y.destroy()}});y.open()}},savePlanningRep:function(e){var t=this.getModel("planningRep");var a=this.getModel("objectView");var s=this.getView(),i=[s.byId("CommentsRep"),s.byId("begdaRep"),s.byId("enddaRep"),s.byId("TP1Rep"),s.byId("TP2Rep")],r=false;i.forEach(function(e){r=this._validateInputNewP(e)||r},this);if(r){sap.m.MessageBox.alert("A validation error has occurred.")}else{if(this.byId("periodTypeRep").getSelectedItem().getKey()=="M"){var n=this.byId("MC1Rep").getSelectedKeys();if(n.length==0){this.byId("MC1Rep").setValueState("Error");sap.m.MessageBox.alert("A validation error has occurred.");return}else{this.byId("MC1Rep").setValueState("None")}}else if(this.byId("periodTypeRep").getSelectedItem().getKey()=="W"){var l=this.byId("daysRep").getItems();var o=false;l.forEach(function(e){if(e.getSelected()){o=true}});if(!o){l.forEach(function(e){e.setValueState("Error")});sap.m.MessageBox.alert("A validation error has occurred.");return}}var d=i[0].getValue();var u="Are you sure you want to save the Job Reprocessing Planning?";var g=this;var p=e.getSource().getParent();var c=new sap.m.Dialog({title:"Confirmation",type:"Message",content:new sap.m.Text({text:u}),beginButton:new sap.m.Button({text:"Yes",press:function(){var e=g.byId("SegButRep").getSelectedKey();var s=false;if(e=="A"){s=true}var i={pck_code:"DI_TEMPLG",type:"D",enable:s,processing_type:"R",comments:d};var r=g.getOwnerComponent().getModel();a.setProperty("/busy",true);if(g.exist_plan_Rep!=="X"){r.create("/Integration_Pck_Planning",i,{headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(e,t){g.onUpdatePlanTemplate(e.uuid,e.processing_type,"X")},error:function(e){a.setProperty("/busy",false);sap.m.MessageToast.show("Error")}})}else{var n=t.getProperty("/uuid");var l="/Integration_Pck_Planning(guid'"+n+"')";r.update(l,i,{headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(e,t){g.updateDataBatch(e.uuid,e.processing_type,"X")},error:function(e){a.setProperty("/busy",false);sap.m.MessageToast.show("Error")}})}c.close()}}),endButton:new sap.m.Button({text:"No",press:function(){c.close()}}),afterClose:function(){c.destroy()}});c.open()}},createDataPlanning:function(e,t){if(t=="X"){var a=this.getModel("planningRep")}else{var a=this.getModel("planning")}var s=a.getProperty("/plan_d");var i=e;var r=s.begda;var n=s.endda;var l=s.time_zone;if(t=="X"){var o=this.byId("TP1Rep").getDateValue()}else{var o=this.byId("TP1").getDateValue()}var d=o.getHours();if(d<10){d="0"+String(d)}var u=o.getMinutes();if(u<10){u="0"+String(u)}var g=o.getSeconds();if(g<10){g="0"+String(g)}var p=d+":"+u+":"+g;if(t=="X"){var c=this.byId("TP2Rep").getDateValue()}else{var c=this.byId("TP2").getDateValue()}d=c.getHours();if(d<10){d="0"+String(d)}u=c.getMinutes();if(u<10){u="0"+String(u)}g=c.getSeconds();if(g<10){g="0"+String(g)}var h=d+":"+u+":"+g;var f=true;var v=s.periodicity_type;if(v=="W"){var b=s.periodicity_values}else if(v=="M"){var b=s.periodicity_valuesM}else{var b=""}var m=s.ontime;if(!m){var y=s.time_frecuency;var _=y.substr(-1);var I=parseInt(y.substr(0,y.length-1))}else{}var V={planning_uuid:i,seqno:2,execute:f,begda:r,endda:n,periodicity_type:v,periodicity_values:b,time_frecuency:I,time_measure:_,time_start:p,time_end:h,time_zone:l};return V},createDataBatch:function(e,t,a){var s=e;var i="/Integration_Pck_Planning_Adata";var r=this.getOwnerComponent().getModel();r.setDeferredGroups(["createGroup"]);var n=this;var l={};l.planning_uuid=s;l.level1="WS_GET_WORKERS";l.level2="TIME_ZONE";if(a!=="X"){l.value=this.byId("TimeZone").getSelectedKey();l.value2=null;r.create(i,l,{groupId:"createGroup"});var o={};o.planning_uuid=s;o.level1="WS_GET_WORKERS";o.level2="NEXT_UPDATED_FROM";o.value="";o.value2=null;r.create(i,o,{groupId:"createGroup"});var d={};d.planning_uuid=s;d.level1="WS_GET_WORKERS";d.level2="INITIAL_DATE_FROM";d.value=this.byId("DTP1").getValue();d.value2=null;r.create(i,d,{groupId:"createGroup"});var u={};u.planning_uuid=s;u.level1="WS_GET_WORKERS";u.level2="RETRO_CHG_EFFECTIVE_FROM";u.value=this.byId("DTP2").getValue();u.value2=null;r.create(i,u,{groupId:"createGroup"});var g={};g.planning_uuid=s;g.level1="WS_GET_WORKERS";g.level2="FUTURE_CHG_UPDATED_FROM";g.value=this.byId("DTP3").getValue();g.value2=null;r.create(i,g,{groupId:"createGroup"})}var p=n.createDataPlanning(e,a);r.create("/Integration_Pck_Planning_D",p,{groupId:"createGroup"});r.submitChanges({groupId:"createGroup",success:this.successCreateBatch.bind(n),error:this.errorCreateBatch.bind(n)})},createPagesBatch:function(e){var t="/Di_Template_Page_Content";var a=this.getOwnerComponent().getModel();a.setDeferredGroups(["createPages"]);var s=this;var i=this.getModel("template").getData().pages_preview;for(var r=0;r<i.length;r++){var n={};n.template_uuid=e;n.page=r+1;n.content=i[r].base64;a.create(t,n,{groupId:"createPages"})}a.submitChanges({groupId:"createPages",success:this.successCreatePages.bind(s),error:this.errorCreatePages.bind(s)})},successCreatePages:function(e){var t=0},errorCreatePages:function(e){var t=0},updateDataBatch:function(e,t,a){var s=e;var i=this;if(a=="X"){var r=this.getModel("planningRep")}else{var r=this.getModel("planning")}var n=this.getOwnerComponent().getModel();n.setDeferredGroups(["updateGroup"]);if(a!=="X"){var l="/Integration_Pck_Planning_Adata";var o=r.getProperty("/adata");var d={};var u=l+"("+o.time_zone_uuid+")";d.uuid=o.time_zone_uuid;d.value=o.time_zone;n.update(u,d,{groupId:"updateGroup"});var g={};g.uuid=o.initial_date_from_uuid;var p=l+"("+g.uuid+")";g.value=o.initial_date_from;n.update(p,g,{groupId:"updateGroup"});var c={};c.uuid=o.fut_upd_from_uuid;var h=l+"("+c.uuid+")";c.value=o.fut_upd_from;n.update(h,c,{groupId:"updateGroup"});var f={};f.uuid=o.retro_effec_from_uuid;var v=l+"("+f.uuid+")";f.value=o.retro_effec_from;n.update(v,f,{groupId:"updateGroup"})}var b=r.getProperty("/plan_d");var m=i.createDataPlanning(e,a);var y="/Integration_Pck_Planning_D(guid'"+b.uuid+"')";n.update(y,m,{groupId:"updateGroup"});n.submitChanges({groupId:"updateGroup",success:i.successUpdateBatchP.bind(i),error:i.errorUpdateBatch})},successUpdateBatchP:function(e,t){sap.m.MessageToast.show("Planning updated succesfully.");var a=this.getModel("objectView");a.setProperty("/busy",false)},errorUpdateBatch:function(e){var t=this.getModel("objectView");t.setProperty("/busy",false);sap.m.MessageToast.show("Error")},successCreateBatch:function(e,t){sap.m.MessageToast.show("Planning created succesfully.");var a=this.getModel("objectView");a.setProperty("/busy",false)},errorCreateBatch:function(e){var t=this.getModel("objectView");t.setProperty("/busy",false);sap.m.MessageToast.show("Error")},_validateInputNewP:function(e){var t="None";var a=false;var s=e.getBinding("value");var i=e.getValue();if(i==""){t="Error";a=true}e.setValueState(t);return a},changeSignType_Dis:function(e){var t=e.getParameter("selectedItem");var a=t.getKey();var s=[this.byId("Reg_Reference_Dis"),this.byId("Tech_Id_Dis"),this.byId("Email_address_Dis"),this.byId("Phone_number_Dis"),this.byId("First_name_Dis"),this.byId("Last_name_Dis"),this.byId("Language_Sign_Dis"),this.byId("checkSMSnot_Dis"),this.byId("checkSMSau_Dis"),this.byId("Language_label_Dis")];switch(a){case"organization":s[0].setRequired(false);s[1].setRequired(false);s[0].setVisible(false);s[1].setVisible(false);s[2].setRequired(true);s[2].setVisible(true);s[3].setRequired(false);s[4].setRequired(false);s[5].setRequired(false);s[6].setRequired(false);s[3].setVisible(false);s[4].setVisible(false);s[5].setVisible(false);s[6].setVisible(false);s[7].setVisible(false);s[8].setVisible(false);s[7].setSelected(false);s[8].setSelected(false);s[9].setVisible(false);break;case"employee":s[0].setRequired(true);s[1].setRequired(false);s[0].setVisible(true);s[1].setVisible(false);s[2].setRequired(false);s[2].setVisible(false);s[3].setRequired(false);s[4].setRequired(false);s[5].setRequired(false);s[6].setRequired(false);s[3].setVisible(true);s[4].setVisible(false);s[5].setVisible(false);s[6].setVisible(false);s[7].setVisible(true);s[8].setVisible(true);s[9].setVisible(false);break;case"manager":s[0].setRequired(false);s[1].setRequired(true);s[0].setVisible(false);s[1].setVisible(true);s[2].setRequired(false);s[2].setVisible(false);s[3].setRequired(false);s[4].setRequired(false);s[5].setRequired(false);s[6].setRequired(false);s[3].setVisible(true);s[4].setVisible(false);s[5].setVisible(false);s[6].setVisible(false);s[7].setVisible(true);s[8].setVisible(true);s[9].setVisible(false);break;case"external":s[0].setRequired(false);s[1].setRequired(false);s[0].setVisible(false);s[1].setVisible(false);s[2].setRequired(true);s[2].setVisible(true);s[3].setRequired(false);s[4].setRequired(true);s[5].setRequired(true);s[6].setRequired(false);s[3].setVisible(true);s[4].setVisible(true);s[5].setVisible(true);s[6].setVisible(true);s[7].setVisible(true);s[8].setVisible(true);s[9].setVisible(true);break;default:break}},changeSignType:function(e){var t=e.getParameter("selectedItem");var a=t.getKey();var s=[this.byId("Reg_Reference"),this.byId("Tech_Id"),this.byId("Email_address"),this.byId("Phone_number"),this.byId("First_name"),this.byId("Last_name"),this.byId("Language_Sign"),this.byId("checkSMSnot"),this.byId("checkSMSau"),this.byId("Language_label")];switch(a){case"organization":s[0].setRequired(false);s[1].setRequired(false);s[0].setVisible(false);s[1].setVisible(false);s[2].setRequired(true);s[2].setVisible(true);s[3].setRequired(false);s[4].setRequired(false);s[5].setRequired(false);s[6].setRequired(false);s[3].setVisible(false);s[4].setVisible(false);s[5].setVisible(false);s[6].setVisible(false);s[7].setVisible(false);s[8].setVisible(false);s[7].setSelected(false);s[8].setSelected(false);s[9].setVisible(false);break;case"employee":s[0].setRequired(true);s[1].setRequired(false);s[0].setVisible(true);s[1].setVisible(false);s[2].setRequired(false);s[2].setVisible(false);s[3].setRequired(false);s[4].setRequired(false);s[5].setRequired(false);s[6].setRequired(false);s[3].setVisible(true);s[4].setVisible(false);s[5].setVisible(false);s[6].setVisible(false);s[7].setVisible(true);s[8].setVisible(true);s[9].setVisible(false);break;case"manager":s[0].setRequired(false);s[1].setRequired(true);s[0].setVisible(false);s[1].setVisible(true);s[2].setRequired(false);s[2].setVisible(false);s[3].setRequired(false);s[4].setRequired(false);s[5].setRequired(false);s[6].setRequired(false);s[3].setVisible(true);s[4].setVisible(false);s[5].setVisible(false);s[6].setVisible(false);s[7].setVisible(true);s[8].setVisible(true);s[9].setVisible(false);break;case"external":s[0].setRequired(false);s[1].setRequired(false);s[0].setVisible(false);s[1].setVisible(false);s[2].setRequired(true);s[2].setVisible(true);s[3].setRequired(false);s[4].setRequired(true);s[5].setRequired(true);s[6].setRequired(false);s[3].setVisible(true);s[4].setVisible(true);s[5].setVisible(true);s[6].setVisible(true);s[7].setVisible(true);s[8].setVisible(true);s[9].setVisible(true);break;default:break}},changeSignType_Edit:function(e){var t=e.getParameter("selectedItem");var a=t.getKey();var s=[this.byId("Reg_Reference_Edit"),this.byId("Tech_Id_Edit"),this.byId("Email_address_Edit"),this.byId("Phone_number_Edit"),this.byId("First_name_Edit"),this.byId("Last_name_Edit"),this.byId("Language_Sign_Edit"),this.byId("checkSMSnot_Edit"),this.byId("checkSMSau_Edit"),this.byId("Language_label_Edit")];switch(a){case"organization":s[0].setRequired(false);s[1].setRequired(false);s[0].setVisible(false);s[1].setVisible(false);s[2].setRequired(true);s[2].setVisible(true);s[3].setRequired(false);s[4].setRequired(false);s[5].setRequired(false);s[6].setRequired(false);s[3].setVisible(false);s[4].setVisible(false);s[5].setVisible(false);s[6].setVisible(false);s[7].setVisible(false);s[8].setVisible(false);s[7].setSelected(false);s[8].setSelected(false);s[9].setVisible(false);break;case"employee":s[0].setRequired(true);s[1].setRequired(false);s[0].setVisible(true);s[1].setVisible(false);s[2].setRequired(false);s[2].setVisible(false);s[3].setRequired(false);s[4].setRequired(false);s[5].setRequired(false);s[6].setRequired(false);s[3].setVisible(true);s[4].setVisible(false);s[5].setVisible(false);s[6].setVisible(false);s[7].setVisible(true);s[8].setVisible(true);s[9].setVisible(false);break;case"manager":s[0].setRequired(false);s[1].setRequired(true);s[0].setVisible(false);s[1].setVisible(true);s[2].setRequired(false);s[2].setVisible(false);s[3].setRequired(false);s[4].setRequired(false);s[5].setRequired(false);s[6].setRequired(false);s[3].setVisible(true);s[4].setVisible(false);s[5].setVisible(false);s[6].setVisible(false);s[7].setVisible(true);s[8].setVisible(true);s[9].setVisible(true);break;case"external":s[0].setRequired(false);s[1].setRequired(false);s[0].setVisible(false);s[1].setVisible(false);s[2].setRequired(true);s[2].setVisible(true);s[3].setRequired(false);s[4].setRequired(true);s[5].setRequired(true);s[6].setRequired(false);s[3].setVisible(true);s[4].setVisible(true);s[5].setVisible(true);s[6].setVisible(true);s[7].setVisible(true);s[8].setVisible(true);s[9].setVisible(true);break;default:break}},onSearchAttr:function(e){var t=e.getParameter("query");t=t.toLowerCase();var a=this.getView().byId("tableAtt");var s=a.getBinding("items");var i=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,t);s.filter([i])},pathAtributte:function(e){this.buttonIdSel=e.getSource().getId();this.pathButtonSel="";if(this.code_id_filled==="WD-WORKERS"){this.openGetPath()}else{this.code_id_filled="WD-WORKERS";this.fill_Parser("GET_WORKERS_35.2")}},selectSource:function(e){this.buttonIdSel=e.getSource().getId();if(this.buttonIdSel.match("ButPathAttri")||this.buttonIdSel.match("ButPathEditAttri")){this.pathButtonSel=""}else if(this.buttonIdSel.match("pathGlobVar")){this.pathButtonSel="";if(this.sourceGVEdit!=""){var t=this.sourceGVEdit}}else{this.pathButtonSel=e.getSource().getParent().getBindingContext("template").getPath();var a=e.getSource().getParent().getBindingContext("template").getPath()+"/source";var t=this.getView().getModel("template").getProperty(a)}if(!this.byId("selSource")){r.load({id:this.getView().getId(),name:"shapein.TemplatesConfiguration.view.fragments.sourceXsd",controller:this}).then(function(e){this.getView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());if(t){this.byId("sourXsdPath").setSelectedKey(t)}e.open()}.bind(this))}else{this.byId("selSource").open();if(t){this.byId("sourXsdPath").setSelectedKey(t)}}},selecSource:function(e){var t=this.byId("sourXsdPath").getSelectedItem().getBindingContext().getPath()+"/xsd_id";var a=this.byId("sourXsdPath").getSelectedItem().getBindingContext().getPath()+"/code";var s=this.getOwnerComponent().getModel();var i=s.getProperty(t);var r=s.getProperty(a);var n=e.getSource().getParent();if(r==this.code_id_filled){n.close();this.openGetPath()}else{this.code_id_filled=r;n.setBusy(true);this.fill_Parser(i)}},cancelSelSource:function(e){var t=e.getSource().getParent();t.close()},fill_Parser:function(e){var t=this.getOwnerComponent().getModel();var a=this.getOwnerComponent().getModel("jerarquia");var s=this.getOwnerComponent().getModel("xsd");var i=this;var r=[];var n=new sap.ui.model.Filter("xsd_id",sap.ui.model.FilterOperator.EQ,e);r.push(n);var l="/Di_Parser_Xsd_Definition";t.read(l,{filters:r,success:function(e,t){var r=e.results;delete e.__metadata;var n=i.getModel("RawModel");n.setData(r);var l=i.pasaratree(r);s.setData(l);a.setData({nodeRoot:{nodes:l}});a.refresh();var o=i.byId("selSource");if(o){i.byId("selSource").setBusy(false);i.byId("selSource").close()}i.openGetPath()},error:function(e){var t=i.byId("selSource");if(t){i.byId("selSource").setBusy(false);i.byId("selSource").close()}sap.m.MessageToast.show("Error Load XSD")}})},pasaratree:function(e,t,a){a=typeof a!=="undefined"?a:[];t=typeof t!=="undefined"?t:{node_id:0};var s=e.filter(function(e){if(e.parent_id===t.node_id){return true}else{return false}});var i=this;if(s.length>0){if(t.node_id===0){a=s}else{t["nodes"]=s}s.forEach(function(t){i.pasaratree(e,t)})}return a},openGetPath:function(){var e=this.buttonIdSel;var t=this.pathButtonSel;var a=this.getView();var s=this;var i="";var n="";var l="";var o=this.getOwnerComponent().getModel();var d="/Di_Template_Mapping_Sources('"+this.code_id_filled+"')/text";var u=o.getProperty(d);var g="";if(e.match("ButPathAttri")){var p=this.byId("PathAttribu").getValue()}else if(e.match("ButPathEditAttri")){var p=this.byId("PathAttribuEdit").getValue();l="X"}else if(e.match("pathGlobVar")){var p=this.byId("Value_GV").getValue();g="X"}else if(e.match("pathMeta")){n="X";var c=t+"/code";var h=t+"/path";this.selectedVarMeta=this.getView().getModel("template").getProperty(c);var p=this.getView().getModel("template").getProperty(h)}else{i="X";var c=t+"/slug";var h=t+"/path";this.selectedVar=this.getView().getModel("template").getProperty(c);var p=this.getView().getModel("template").getProperty(h)}if(!this.byId("treeTable")){r.load({id:a.getId(),name:"shapein.TemplatesConfiguration.view.fragments.treeTable",controller:this}).then(function(e){a.addDependent(e);e.addStyleClass(s.getOwnerComponent().getContentDensityClass());if(i=="X"){var t=u+": "+s.selectedVar;e.setTitle(t);s.byId("BtnAccept").setVisible(true);s.byId("BtnAccept2").setVisible(false);s.byId("BtnAccept3").setVisible(false);s.byId("BtnAccept4").setVisible(false);s.byId("BtnAccept5").setVisible(false)}else if(n=="X"){var t=u+": "+s.selectedVarMeta;e.setTitle(t);s.byId("BtnAccept").setVisible(false);s.byId("BtnAccept2").setVisible(false);s.byId("BtnAccept3").setVisible(false);s.byId("BtnAccept4").setVisible(false);s.byId("BtnAccept5").setVisible(true)}else if(g=="X"){var t=u;e.setTitle(t);s.byId("BtnAccept").setVisible(false);s.byId("BtnAccept2").setVisible(false);s.byId("BtnAccept3").setVisible(false);s.byId("BtnAccept4").setVisible(true);s.byId("BtnAccept5").setVisible(false)}else{var t=u;e.setTitle(t);if(l!="X"){s.byId("BtnAccept2").setVisible(true);s.byId("BtnAccept").setVisible(false);s.byId("BtnAccept3").setVisible(false);s.byId("BtnAccept4").setVisible(false);s.byId("BtnAccept5").setVisible(false)}else{s.byId("BtnAccept3").setVisible(true);s.byId("BtnAccept").setVisible(false);s.byId("BtnAccept2").setVisible(false);s.byId("BtnAccept4").setVisible(false);s.byId("BtnAccept5").setVisible(false)}}e.open();var r=s.byId("TreeTableBasic1");r.expandToLevel(3);var o=s.byId("pathTextArea");o.setValue(p)})}else{if(i=="X"){var f=u+": "+s.selectedVar;this.byId("treeTable").setTitle(f);this.byId("BtnAccept").setVisible(true);this.byId("BtnAccept2").setVisible(false);this.byId("BtnAccept3").setVisible(false);this.byId("BtnAccept4").setVisible(false);this.byId("BtnAccept5").setVisible(false)}else if(n=="X"){var f=u+": "+s.selectedVarMeta;this.byId("treeTable").setTitle(f);this.byId("BtnAccept").setVisible(false);this.byId("BtnAccept2").setVisible(false);this.byId("BtnAccept3").setVisible(false);this.byId("BtnAccept4").setVisible(false);this.byId("BtnAccept5").setVisible(true)}else if(g=="X"){var f=u;this.byId("treeTable").setTitle(f);this.byId("BtnAccept").setVisible(false);this.byId("BtnAccept2").setVisible(false);this.byId("BtnAccept3").setVisible(false);this.byId("BtnAccept4").setVisible(true);this.byId("BtnAccept5").setVisible(false)}else{if(l!="X"){this.byId("BtnAccept2").setVisible(true);this.byId("BtnAccept").setVisible(false);this.byId("BtnAccept3").setVisible(false);this.byId("BtnAccept4").setVisible(false);this.byId("BtnAccept5").setVisible(false)}else{this.byId("BtnAccept3").setVisible(true);this.byId("BtnAccept2").setVisible(false);this.byId("BtnAccept").setVisible(false);this.byId("BtnAccept4").setVisible(false);this.byId("BtnAccept5").setVisible(false)}var f=u;this.byId("treeTable").setTitle(f)}this.byId("treeTable").open();var v=s.byId("pathTextArea");v.setValue(p)}},onCloseTableTree:function(e){var t=this.byId("pathTextArea");var a="";t.setValue(a);this.byId("treeTable").close()},applySearch1:function(){var e=this.getView().getModel("SearchIndex").getData();var t=this.getView();var a=t.byId("TreeTableBasic1");l++;if(l<e.length){var s=e[l];a.setSelectedIndex(s);a.setFirstVisibleRow(s);sap.m.MessageToast.show("Search :"+(l+1)+"/"+e.length)}else{l--;sap.m.MessageToast.show("No further matches for this search string.")}},applySearch2:function(){var e=this.getView().getModel("SearchIndex").getData();var t=this.getView();var a=t.byId("TreeTableBasic1");l--;if(l>-1){var s=e[l];a.setSelectedIndex(s);a.setFirstVisibleRow(s);sap.m.MessageToast.show("Search :"+(l+1)+"/"+e.length)}else{l++;sap.m.MessageToast.show("No further matches for this search string.")}},matchRuleShort:function(e,t){var a=e=>e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1");return new RegExp("^"+t.split("*").map(a).join(".*")+"$").test(e)},filterNode1:function(e){var a=e.getParameter("query");o=a;var s=this.getView();var i=s.byId("TreeTableBasic1");var r=this.getModel("RawModel").getData();i.expandToLevel(15);var n=[];for(var d=0;d<r.length;d++){var u=i.getContextByIndex(d);if(u){if(u.getObject().fieldname.toLowerCase().includes(a.toLowerCase())){n.push(d)}}}if(n.length!==0){var g=new t;g.setData(n);this.getView().setModel(g,"SearchIndex");i.setSelectedIndex(n[0]);i.setFirstVisibleRow(n[0]);l=0;sap.m.MessageToast.show("Search :"+(l+1)+"/"+n.length)}else{if(a!==""){var p=[];var c=new t;c.setData(p);this.getView().setModel(c,"SearchIndex");sap.m.MessageToast.show("No match for this search string.")}}},filterNode:function(e){var a=e.getParameter("query");o=a;var s=this.getView();var i=s.byId("TreeTableBasic1");var r=this.getView().getModel("jerarquia").getData();i.expandToLevel(15);var n=[];var d=this.getModel("RawModel").getData();for(var u=0;u<d.length;u++){if(d[u].fieldname.includes(a)&&a!=""){n.push(d[u].node_id)}}if(n.length!=0){var g=new t;g.setData(n);this.getView().setModel(g,"SearchIndex");var p=n[0]-2;if(p<0){p=0}while(p!=-1){var c=i.getContextByIndex(p);if(c.getObject().fieldname.includes(a)){i.setSelectedIndex(p);i.setFirstVisibleRow(p);l=1;break}else{p=p-1}}}else{if(a!=""){sap.m.MessageToast.show("No coincidence for this criteria.")}}},onMap:function(e){var t=this.getView().byId("pathTextArea");var a=t.getValue();var s=this.getModel("template").getData();var i=s.variables.find(e=>e.slug===this.selectedVar);i.path=a;i.source=this.code_id_filled;this.getModel("template").setData(s);this.getModel("template").refresh();this.byId("treeTable").close()},onMap5:function(e){var t=this.getView().byId("pathTextArea");var a=t.getValue();var s=this.getModel("template").getData();var i=s.metadata.find(e=>e.code===this.selectedVarMeta);i.path=a;i.source=this.code_id_filled;this.getModel("template").setData(s);this.getModel("template").refresh();this.byId("treeTable").close()},onMap2:function(e){var t=this.getView().byId("pathTextArea");var a=t.getValue();this.byId("PathAttribu").setValue(a);this.byId("treeTable").close()},onMap3:function(e){var t=this.getView().byId("pathTextArea");var a=t.getValue();this.byId("PathAttribuEdit").setValue(a);this.byId("treeTable").close()},onMap4:function(e){var t=this.getView().byId("pathTextArea");var a=t.getValue();this.byId("Value_GV").setValue(a);this.byId("Source_GV").setValue(this.code_id_filled);this.byId("treeTable").close()},onCollapseAll:function(){var e=this.byId("TreeTableBasic1");e.collapseAll()},onCollapseSelection:function(){var e=this.byId("TreeTableBasic1");e.collapse(e.getSelectedIndices())},onExpandFirstLevel:function(){var e=this.byId("TreeTableBasic1");e.expandToLevel(1)},onExpandSelection:function(e){var t=this.byId("TreeTableBasic1");t.expand(t.getSelectedIndices());var a=t.getSelectedIndex();var s=t.getRows()[a].oBindingContexts.ModelTreeTable1.sPath;var i=this.getView().byId("input0");i.setValue(s)},onExpandAll:function(e){var t=this.getView();var a=t.byId("TreeTableBasic1");a.expandToLevel(15)},getPath:function(e){var t=this.byId("TreeTableBasic1");var a=t.getSelectedIndex();if(a===-1){sap.m.MessageToast.show("Please, select a node to get the path.")}else{var s=t.getContextByIndex(a).getPath();var i=s.split("/");var r="/";var n="/";var l;for(var o=1;o<i.length;o++){if(/^\d+$/.test(i[o])){n=n+i[o]+"/";l=this.getView().getModel("jerarquia").getProperty(n+"fieldname");r=r+l+"/"}else{n=n+i[o]+"/"}}r=r.slice(0,-1);var d=this.getView().byId("pathTextArea");var u=d.getValue();r=u+r;d.setValue(r)}}})});